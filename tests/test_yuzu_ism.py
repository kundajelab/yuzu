# test_yuzu_ism.py
# Author: Jacob Schreiber <jmschreiber91@gmail.com>

"""
Testing the yuzu ISM implementation using the built-in models. These are
regression tests. 
"""

import numpy

from numpy.testing import assert_array_almost_equal

from yuzu import yuzu_ism
from yuzu import precompute
from yuzu.models import *

n_seqs = 2
seq_len = 100

idxs = numpy.random.RandomState(0).randn(n_seqs, 4, seq_len).argmax(axis=1)
X = numpy.zeros((n_seqs, 4, seq_len), dtype='float32')
for i in range(n_seqs):
	X[i, idxs[i], numpy.arange(seq_len)] = 1

def test_one_layer():
	one_layer_ism_scores = numpy.array([
	  [[3.2185, 3.4057, 3.6187, 0.    , 0.    , 4.2084, 0.    , 0.    ,
		4.2084, 4.2084, 4.2084, 0.    , 3.9   , 4.2084, 0.    , 4.2084,
		0.    , 3.9   , 3.9   , 4.2084, 4.2084, 0.    , 0.    , 4.2084,
		0.    , 3.9   , 3.9   , 3.9899, 0.    , 0.    , 3.9899, 4.2084,
		3.9899, 3.9   , 0.    , 3.9   , 3.9   , 0.    , 3.9   , 3.9899,
		3.9899, 4.2084, 4.2084, 0.    , 4.2084, 4.2084, 3.9   , 4.2084,
		3.9899, 3.9899, 3.9   , 4.2084, 3.9899, 3.9   , 3.9   , 3.9   ,
		4.2084, 0.    , 3.9899, 3.9899, 3.9899, 4.2084, 4.2084, 3.9899,
		0.    , 4.2084, 3.9   , 0.    , 4.2084, 4.2084, 4.2084, 4.2084,
		3.9   , 3.9   , 0.    , 4.2084, 3.9899, 3.9   , 3.9899, 3.9   ,
		3.9   , 3.9   , 0.    , 3.9   , 0.    , 0.    , 0.    , 3.9   ,
		3.9899, 4.2084, 3.9899, 0.    , 3.9   , 0.    , 4.2084, 3.9   ,
		3.9899, 0.    , 3.5001, 3.1382],
	   [0.    , 3.4242, 3.7728, 4.2084, 4.2084, 0.    , 4.2084, 4.2084,
		0.    , 0.    , 0.    , 4.2084, 4.0387, 0.    , 4.2084, 0.    ,
		4.2084, 4.0387, 4.0387, 0.    , 0.    , 4.2084, 4.2084, 0.    ,
		4.2084, 4.0387, 4.0387, 4.0571, 4.2084, 4.2084, 4.0571, 0.    ,
		4.0571, 4.0387, 4.2084, 4.0387, 4.0387, 4.2084, 4.0387, 4.0571,
		4.0571, 0.    , 0.    , 4.2084, 0.    , 0.    , 4.0387, 0.    ,
		4.0571, 4.0571, 4.0387, 0.    , 4.0571, 4.0387, 4.0387, 4.0387,
		0.    , 4.2084, 4.0571, 4.0571, 4.0571, 0.    , 0.    , 4.0571,
		4.2084, 0.    , 4.0387, 4.2084, 0.    , 0.    , 0.    , 0.    ,
		4.0387, 4.0387, 4.2084, 0.    , 4.0571, 4.0387, 4.0571, 4.0387,
		4.0387, 4.0387, 4.2084, 4.0387, 4.2084, 4.2084, 4.2084, 4.0387,
		4.0571, 0.    , 4.0571, 4.2084, 4.0387, 4.2084, 0.    , 4.0387,
		4.0571, 3.8645, 0.    , 0.    ],
	   [3.0911, 3.3269, 0.    , 3.9   , 3.9   , 4.0387, 3.9   , 3.9   ,
		4.0387, 4.0387, 4.0387, 3.9   , 0.    , 4.0387, 3.9   , 4.0387,
		3.9   , 0.    , 0.    , 4.0387, 4.0387, 3.9   , 3.9   , 4.0387,
		3.9   , 0.    , 0.    , 3.988 , 3.9   , 3.9   , 3.988 , 4.0387,
		3.988 , 0.    , 3.9   , 0.    , 0.    , 3.9   , 0.    , 3.988 ,
		3.988 , 4.0387, 4.0387, 3.9   , 4.0387, 4.0387, 0.    , 4.0387,
		3.988 , 3.988 , 0.    , 4.0387, 3.988 , 0.    , 0.    , 0.    ,
		4.0387, 3.9   , 3.988 , 3.988 , 3.988 , 4.0387, 4.0387, 3.988 ,
		3.9   , 4.0387, 0.    , 3.9   , 4.0387, 4.0387, 4.0387, 4.0387,
		0.    , 0.    , 3.9   , 4.0387, 3.988 , 0.    , 3.988 , 0.    ,
		0.    , 0.    , 3.9   , 0.    , 3.9   , 3.9   , 3.9   , 0.    ,
		3.988 , 4.0387, 3.988 , 3.9   , 0.    , 3.9   , 4.0387, 0.    ,
		3.988 , 3.6128, 3.4   , 2.9923],
	   [3.0721, 0.    , 3.6562, 3.9899, 3.9899, 4.0571, 3.9899, 3.9899,
		4.0571, 4.0571, 4.0571, 3.9899, 3.988 , 4.0571, 3.9899, 4.0571,
		3.9899, 3.988 , 3.988 , 4.0571, 4.0571, 3.9899, 3.9899, 4.0571,
		3.9899, 3.988 , 3.988 , 0.    , 3.9899, 3.9899, 0.    , 4.0571,
		0.    , 3.988 , 3.9899, 3.988 , 3.988 , 3.9899, 3.988 , 0.    ,
		0.    , 4.0571, 4.0571, 3.9899, 4.0571, 4.0571, 3.988 , 4.0571,
		0.    , 0.    , 3.988 , 4.0571, 0.    , 3.988 , 3.988 , 3.988 ,
		4.0571, 3.9899, 0.    , 0.    , 0.    , 4.0571, 4.0571, 0.    ,
		3.9899, 4.0571, 3.988 , 3.9899, 4.0571, 4.0571, 4.0571, 4.0571,
		3.988 , 3.988 , 3.9899, 4.0571, 0.    , 3.988 , 0.    , 3.988 ,
		3.988 , 3.988 , 3.9899, 3.988 , 3.9899, 3.9899, 3.9899, 3.988 ,
		0.    , 4.0571, 0.    , 3.9899, 3.988 , 3.9899, 4.0571, 3.988 ,
		0.    , 3.6657, 3.4122, 3.0508]], 

	  [[3.2185, 3.3533, 3.9375, 3.9899, 3.9899, 3.9899, 3.9899, 0.    ,
		3.9899, 4.2084, 4.2084, 4.2084, 3.9   , 3.9   , 0.    , 0.    ,
		4.2084, 4.2084, 0.    , 4.2084, 0.    , 0.    , 3.9899, 0.    ,
		4.2084, 0.    , 0.    , 3.9   , 3.9899, 4.2084, 0.    , 4.2084,
		4.2084, 0.    , 3.9899, 3.9   , 0.    , 3.9   , 3.9   , 3.9   ,
		4.2084, 3.9   , 3.9899, 4.2084, 0.    , 3.9899, 4.2084, 3.9899,
		4.2084, 3.9   , 3.9899, 0.    , 4.2084, 3.9899, 0.    , 0.    ,
		3.9899, 4.2084, 0.    , 0.    , 4.2084, 3.9899, 3.9899, 0.    ,
		3.9899, 0.    , 4.2084, 3.9   , 3.9899, 4.2084, 4.2084, 3.9899,
		4.2084, 4.2084, 0.    , 0.    , 0.    , 3.9   , 3.9   , 4.2084,
		3.9899, 3.9   , 3.9   , 3.9   , 0.    , 3.9899, 3.9   , 0.    ,
		3.9   , 3.9   , 4.2084, 3.9   , 0.    , 3.9899, 0.    , 3.9   ,
		3.9899, 3.8645, 3.3167, 2.9352],
	   [0.    , 3.4626, 0.    , 4.0571, 4.0571, 4.0571, 4.0571, 4.2084,
		4.0571, 0.    , 0.    , 0.    , 4.0387, 4.0387, 4.2084, 4.2084,
		0.    , 0.    , 4.2084, 0.    , 4.2084, 4.2084, 4.0571, 4.2084,
		0.    , 4.2084, 4.2084, 4.0387, 4.0571, 0.    , 4.2084, 0.    ,
		0.    , 4.2084, 4.0571, 4.0387, 4.2084, 4.0387, 4.0387, 4.0387,
		0.    , 4.0387, 4.0571, 0.    , 4.2084, 4.0571, 0.    , 4.0571,
		0.    , 4.0387, 4.0571, 4.2084, 0.    , 4.0571, 4.2084, 4.2084,
		4.0571, 0.    , 4.2084, 4.2084, 0.    , 4.0571, 4.0571, 4.2084,
		4.0571, 4.2084, 0.    , 4.0387, 4.0571, 0.    , 0.    , 4.0571,
		0.    , 0.    , 4.2084, 4.2084, 4.2084, 4.0387, 4.0387, 0.    ,
		4.0571, 4.0387, 4.0387, 4.0387, 4.2084, 4.0571, 4.0387, 4.2084,
		4.0387, 4.0387, 0.    , 4.0387, 4.2084, 4.0571, 4.2084, 4.0387,
		4.0571, 0.    , 3.4   , 2.9923],
	   [3.0911, 0.    , 3.7728, 3.988 , 3.988 , 3.988 , 3.988 , 3.9   ,
		3.988 , 4.0387, 4.0387, 4.0387, 0.    , 0.    , 3.9   , 3.9   ,
		4.0387, 4.0387, 3.9   , 4.0387, 3.9   , 3.9   , 3.988 , 3.9   ,
		4.0387, 3.9   , 3.9   , 0.    , 3.988 , 4.0387, 3.9   , 4.0387,
		4.0387, 3.9   , 3.988 , 0.    , 3.9   , 0.    , 0.    , 0.    ,
		4.0387, 0.    , 3.988 , 4.0387, 3.9   , 3.988 , 4.0387, 3.988 ,
		4.0387, 0.    , 3.988 , 3.9   , 4.0387, 3.988 , 3.9   , 3.9   ,
		3.988 , 4.0387, 3.9   , 3.9   , 4.0387, 3.988 , 3.988 , 3.9   ,
		3.988 , 3.9   , 4.0387, 0.    , 3.988 , 4.0387, 4.0387, 3.988 ,
		4.0387, 4.0387, 3.9   , 3.9   , 3.9   , 0.    , 0.    , 4.0387,
		3.988 , 0.    , 0.    , 0.    , 3.9   , 3.988 , 0.    , 3.9   ,
		0.    , 0.    , 4.0387, 0.    , 3.9   , 3.988 , 3.9   , 0.    ,
		3.988 , 3.7734, 0.    , 0.    ],
	   [3.0721, 3.3269, 3.7327, 0.    , 0.    , 0.    , 0.    , 3.9899,
		0.    , 4.0571, 4.0571, 4.0571, 3.988 , 3.988 , 3.9899, 3.9899,
		4.0571, 4.0571, 3.9899, 4.0571, 3.9899, 3.9899, 0.    , 3.9899,
		4.0571, 3.9899, 3.9899, 3.988 , 0.    , 4.0571, 3.9899, 4.0571,
		4.0571, 3.9899, 0.    , 3.988 , 3.9899, 3.988 , 3.988 , 3.988 ,
		4.0571, 3.988 , 0.    , 4.0571, 3.9899, 0.    , 4.0571, 0.    ,
		4.0571, 3.988 , 0.    , 3.9899, 4.0571, 0.    , 3.9899, 3.9899,
		0.    , 4.0571, 3.9899, 3.9899, 4.0571, 0.    , 0.    , 3.9899,
		0.    , 3.9899, 4.0571, 3.988 , 0.    , 4.0571, 4.0571, 0.    ,
		4.0571, 4.0571, 3.9899, 3.9899, 3.9899, 3.988 , 3.988 , 4.0571,
		0.    , 3.988 , 3.988 , 3.988 , 3.9899, 0.    , 3.988 , 3.9899,
		3.988 , 3.988 , 4.0571, 3.988 , 3.9899, 0.    , 3.9899, 3.988 ,
		0.    , 3.7677, 3.3241, 2.9875]]])

	model = OneLayer(4, seq_len)
	precomputation = precompute(model, seq_len=seq_len, n_choices=4, alpha=4)
	isms = yuzu_ism(model, X, precomputation)
	assert_array_almost_equal(isms, one_layer_ism_scores, 3)

def test_toynet():
	toynet_ism_scores = numpy.array([
	  [[0.0399, 0.0635, 0.0593, 0.    , 0.    , 0.0775, 0.    , 0.    ,
		0.0696, 0.0713, 0.0707, 0.    , 0.0749, 0.0747, 0.    , 0.0871,
		0.    , 0.0819, 0.0649, 0.0941, 0.0863, 0.    , 0.    , 0.0791,
		0.    , 0.0763, 0.0905, 0.0736, 0.    , 0.    , 0.0761, 0.0805,
		0.0622, 0.0605, 0.    , 0.0705, 0.0656, 0.    , 0.0849, 0.0746,
		0.0772, 0.0737, 0.0798, 0.    , 0.0689, 0.0756, 0.0865, 0.0973,
		0.0627, 0.0981, 0.0767, 0.0696, 0.0753, 0.0766, 0.0657, 0.0618,
		0.0954, 0.    , 0.098 , 0.0837, 0.0812, 0.1021, 0.0708, 0.0712,
		0.    , 0.071 , 0.0731, 0.    , 0.0707, 0.0624, 0.078 , 0.0674,
		0.074 , 0.0554, 0.    , 0.0921, 0.0684, 0.0717, 0.093 , 0.0697,
		0.0741, 0.0767, 0.    , 0.0702, 0.    , 0.    , 0.    , 0.0689,
		0.071 , 0.0772, 0.0745, 0.    , 0.0629, 0.    , 0.0508, 0.0821,
		0.0652, 0.    , 0.0336, 0.0457],
	   [0.    , 0.0566, 0.0688, 0.0728, 0.0633, 0.    , 0.1008, 0.0704,
		0.    , 0.    , 0.    , 0.0744, 0.0904, 0.    , 0.0623, 0.    ,
		0.0667, 0.0749, 0.0816, 0.    , 0.    , 0.0912, 0.0808, 0.    ,
		0.0715, 0.0833, 0.0844, 0.1   , 0.0761, 0.0713, 0.0863, 0.    ,
		0.0936, 0.0868, 0.062 , 0.0923, 0.0689, 0.0919, 0.083 , 0.0791,
		0.0864, 0.    , 0.    , 0.0728, 0.    , 0.    , 0.0865, 0.    ,
		0.1026, 0.0975, 0.0812, 0.    , 0.1031, 0.0808, 0.0814, 0.0828,
		0.    , 0.0881, 0.1038, 0.09  , 0.0982, 0.    , 0.    , 0.1008,
		0.085 , 0.    , 0.0972, 0.0838, 0.    , 0.    , 0.    , 0.    ,
		0.0685, 0.0782, 0.0921, 0.    , 0.0939, 0.0862, 0.1007, 0.0609,
		0.0666, 0.0824, 0.0651, 0.0796, 0.0704, 0.0771, 0.0815, 0.0944,
		0.0952, 0.    , 0.1137, 0.0725, 0.071 , 0.0758, 0.    , 0.0711,
		0.0659, 0.0598, 0.    , 0.    ],
	   [0.0536, 0.055 , 0.    , 0.0677, 0.0685, 0.0668, 0.0775, 0.078 ,
		0.0906, 0.0818, 0.0852, 0.08  , 0.    , 0.0753, 0.0667, 0.0915,
		0.0812, 0.    , 0.    , 0.0819, 0.1007, 0.0859, 0.0661, 0.0921,
		0.0669, 0.    , 0.    , 0.0882, 0.0819, 0.0735, 0.0914, 0.0707,
		0.0997, 0.    , 0.065 , 0.    , 0.    , 0.0789, 0.    , 0.0705,
		0.0947, 0.0807, 0.1026, 0.0746, 0.0841, 0.0635, 0.    , 0.0948,
		0.0668, 0.1016, 0.    , 0.0824, 0.0912, 0.    , 0.    , 0.    ,
		0.079 , 0.0911, 0.096 , 0.0828, 0.0954, 0.0916, 0.1145, 0.0995,
		0.0772, 0.0662, 0.    , 0.0886, 0.0866, 0.0816, 0.0905, 0.0932,
		0.    , 0.    , 0.0795, 0.0732, 0.0656, 0.    , 0.1004, 0.    ,
		0.    , 0.    , 0.0866, 0.    , 0.0765, 0.0861, 0.0712, 0.    ,
		0.0915, 0.0751, 0.1   , 0.0854, 0.    , 0.0653, 0.0722, 0.    ,
		0.0719, 0.0538, 0.0516, 0.0462],
	   [0.0528, 0.    , 0.0735, 0.0792, 0.0847, 0.0847, 0.0815, 0.0567,
		0.0986, 0.0975, 0.0866, 0.0749, 0.1056, 0.1028, 0.0514, 0.1104,
		0.0784, 0.0958, 0.0764, 0.096 , 0.1081, 0.0978, 0.0935, 0.105 ,
		0.0841, 0.0999, 0.0817, 0.    , 0.0859, 0.073 , 0.    , 0.0826,
		0.    , 0.1168, 0.093 , 0.0923, 0.0745, 0.0787, 0.0866, 0.    ,
		0.    , 0.1   , 0.0908, 0.0774, 0.1134, 0.0923, 0.1083, 0.1016,
		0.    , 0.    , 0.0893, 0.0819, 0.    , 0.0989, 0.0816, 0.0937,
		0.0861, 0.0666, 0.    , 0.    , 0.    , 0.1064, 0.1054, 0.    ,
		0.1048, 0.078 , 0.0758, 0.0843, 0.0935, 0.0976, 0.0856, 0.0952,
		0.0954, 0.087 , 0.0834, 0.0909, 0.    , 0.1111, 0.    , 0.0962,
		0.096 , 0.0805, 0.0721, 0.0955, 0.0773, 0.0735, 0.0689, 0.0836,
		0.    , 0.0791, 0.    , 0.0884, 0.0789, 0.0847, 0.0693, 0.074 ,
		0.    , 0.0727, 0.0708, 0.056 ]], 

	  [[0.0465, 0.0542, 0.0729, 0.0805, 0.0935, 0.0795, 0.0806, 0.    ,
		0.0751, 0.091 , 0.0874, 0.0786, 0.0843, 0.0749, 0.    , 0.    ,
		0.0838, 0.0894, 0.    , 0.0667, 0.    , 0.    , 0.0789, 0.    ,
		0.0959, 0.    , 0.    , 0.0826, 0.0823, 0.0908, 0.    , 0.0831,
		0.0729, 0.    , 0.0668, 0.0724, 0.    , 0.0659, 0.0674, 0.0911,
		0.081 , 0.0894, 0.0896, 0.09  , 0.    , 0.089 , 0.0848, 0.0746,
		0.0788, 0.089 , 0.0759, 0.    , 0.0766, 0.0808, 0.    , 0.    ,
		0.0834, 0.0889, 0.    , 0.    , 0.0721, 0.0797, 0.0886, 0.    ,
		0.0759, 0.    , 0.0669, 0.081 , 0.0864, 0.0827, 0.0746, 0.0808,
		0.0693, 0.074 , 0.    , 0.    , 0.    , 0.07  , 0.0839, 0.0791,
		0.0691, 0.0812, 0.07  , 0.0805, 0.    , 0.0815, 0.0722, 0.    ,
		0.0726, 0.0804, 0.089 , 0.069 , 0.    , 0.0746, 0.    , 0.0568,
		0.0694, 0.0613, 0.0605, 0.0523],
	   [0.    , 0.0658, 0.    , 0.07  , 0.0858, 0.083 , 0.0871, 0.0871,
		0.096 , 0.    , 0.    , 0.    , 0.0794, 0.0835, 0.0802, 0.0763,
		0.    , 0.    , 0.064 , 0.    , 0.0718, 0.07  , 0.0865, 0.0745,
		0.    , 0.0819, 0.0902, 0.0874, 0.0974, 0.    , 0.0904, 0.    ,
		0.    , 0.0789, 0.0849, 0.0807, 0.0638, 0.0917, 0.08  , 0.0889,
		0.    , 0.094 , 0.0815, 0.    , 0.0867, 0.0917, 0.    , 0.0912,
		0.    , 0.0916, 0.0999, 0.0826, 0.    , 0.0919, 0.0771, 0.0686,
		0.0848, 0.    , 0.0889, 0.0773, 0.    , 0.0901, 0.098 , 0.086 ,
		0.0737, 0.0791, 0.    , 0.0845, 0.0874, 0.    , 0.    , 0.105 ,
		0.    , 0.    , 0.0672, 0.0838, 0.0756, 0.0788, 0.0695, 0.    ,
		0.1191, 0.0903, 0.0572, 0.0805, 0.0836, 0.0727, 0.0804, 0.071 ,
		0.0771, 0.0916, 0.    , 0.0826, 0.0795, 0.0656, 0.0841, 0.0739,
		0.0876, 0.    , 0.0559, 0.0404],
	   [0.0416, 0.    , 0.0743, 0.0695, 0.0809, 0.0668, 0.0898, 0.0838,
		0.0785, 0.1032, 0.0779, 0.0879, 0.    , 0.    , 0.0856, 0.0827,
		0.0923, 0.0928, 0.077 , 0.0834, 0.0652, 0.071 , 0.0886, 0.0648,
		0.0819, 0.0797, 0.0798, 0.    , 0.0778, 0.0894, 0.0864, 0.0926,
		0.0897, 0.0687, 0.0919, 0.    , 0.0701, 0.    , 0.    , 0.    ,
		0.0811, 0.    , 0.0953, 0.0934, 0.0687, 0.1113, 0.0692, 0.0955,
		0.0871, 0.    , 0.0917, 0.0648, 0.0873, 0.0922, 0.0696, 0.0698,
		0.0952, 0.0987, 0.0936, 0.0775, 0.0911, 0.0768, 0.0894, 0.0826,
		0.0755, 0.0745, 0.0734, 0.    , 0.073 , 0.1081, 0.0773, 0.0922,
		0.0705, 0.0821, 0.065 , 0.0647, 0.0644, 0.    , 0.    , 0.0824,
		0.109 , 0.    , 0.    , 0.    , 0.0718, 0.0919, 0.    , 0.0804,
		0.    , 0.    , 0.0787, 0.    , 0.0831, 0.0895, 0.066 , 0.    ,
		0.0844, 0.0746, 0.    , 0.    ],
	   [0.0751, 0.0602, 0.06  , 0.    , 0.    , 0.    , 0.    , 0.0896,
		0.    , 0.1198, 0.0916, 0.0971, 0.1006, 0.0845, 0.0751, 0.0726,
		0.1134, 0.1057, 0.0771, 0.098 , 0.0847, 0.0836, 0.    , 0.0886,
		0.0961, 0.0749, 0.086 , 0.0694, 0.    , 0.1029, 0.0556, 0.0877,
		0.0925, 0.0698, 0.    , 0.085 , 0.1036, 0.0751, 0.0882, 0.1011,
		0.0995, 0.0943, 0.    , 0.0937, 0.0716, 0.    , 0.0834, 0.    ,
		0.0998, 0.0784, 0.    , 0.087 , 0.066 , 0.    , 0.105 , 0.0742,
		0.    , 0.0985, 0.0731, 0.0771, 0.0948, 0.    , 0.    , 0.097 ,
		0.    , 0.0894, 0.0734, 0.0772, 0.    , 0.1262, 0.0744, 0.    ,
		0.068 , 0.0847, 0.0794, 0.0735, 0.0669, 0.0641, 0.0842, 0.1018,
		0.    , 0.1259, 0.0883, 0.1003, 0.0929, 0.    , 0.0907, 0.0879,
		0.0921, 0.0931, 0.0985, 0.0819, 0.0868, 0.    , 0.0989, 0.0848,
		0.    , 0.0671, 0.0676, 0.059 ]]])

	model = ToyNet(4, seq_len)
	precomputation = precompute(model, seq_len=seq_len, n_choices=4, alpha=4)
	isms = yuzu_ism(model, X, precomputation)
	assert_array_almost_equal(isms, toynet_ism_scores, 3)

def test_deepsea():
	deepsea_ism_scores = numpy.array([
	  [[0.0104, 0.0128, 0.0128, 0.    , 0.    , 0.0159, 0.    , 0.    ,
		0.0173, 0.0178, 0.0181, 0.    , 0.0186, 0.0199, 0.    , 0.0214,
		0.    , 0.0198, 0.0203, 0.0217, 0.0218, 0.    , 0.    , 0.0228,
		0.    , 0.0208, 0.0223, 0.0228, 0.    , 0.    , 0.0226, 0.0214,
		0.0229, 0.0219, 0.    , 0.0213, 0.0216, 0.    , 0.0206, 0.0223,
		0.0239, 0.0214, 0.0229, 0.    , 0.0211, 0.0227, 0.0213, 0.0218,
		0.0211, 0.0224, 0.0245, 0.0227, 0.0232, 0.0224, 0.0237, 0.0228,
		0.0217, 0.    , 0.0208, 0.0202, 0.0222, 0.0226, 0.024 , 0.0221,
		0.    , 0.021 , 0.0224, 0.    , 0.0214, 0.0227, 0.0219, 0.0213,
		0.0231, 0.0216, 0.    , 0.0222, 0.0217, 0.0205, 0.0222, 0.0207,
		0.02  , 0.0198, 0.    , 0.0184, 0.    , 0.    , 0.    , 0.0175,
		0.0173, 0.0159, 0.0162, 0.    , 0.0164, 0.    , 0.0158, 0.0165,
		0.0148, 0.    , 0.0127, 0.0107],
	   [0.    , 0.0131, 0.0131, 0.0135, 0.0165, 0.    , 0.0162, 0.0172,
		0.    , 0.    , 0.    , 0.0185, 0.0198, 0.    , 0.021 , 0.    ,
		0.0214, 0.0209, 0.0226, 0.    , 0.    , 0.0228, 0.0217, 0.    ,
		0.0223, 0.0225, 0.0216, 0.024 , 0.0218, 0.02  , 0.023 , 0.    ,
		0.0229, 0.0234, 0.0215, 0.0221, 0.0221, 0.0224, 0.0223, 0.0227,
		0.0244, 0.    , 0.    , 0.0219, 0.    , 0.    , 0.0232, 0.    ,
		0.0199, 0.0231, 0.0222, 0.    , 0.0238, 0.0231, 0.022 , 0.0242,
		0.    , 0.021 , 0.0227, 0.0202, 0.0223, 0.    , 0.    , 0.0209,
		0.0203, 0.    , 0.0216, 0.0203, 0.    , 0.    , 0.    , 0.    ,
		0.0221, 0.0214, 0.0223, 0.    , 0.0219, 0.0203, 0.0209, 0.0196,
		0.018 , 0.0199, 0.0186, 0.0194, 0.0186, 0.0176, 0.0182, 0.018 ,
		0.0175, 0.    , 0.0171, 0.0167, 0.0158, 0.0165, 0.    , 0.0156,
		0.0146, 0.0134, 0.    , 0.    ],
	   [0.0116, 0.0127, 0.    , 0.015 , 0.0155, 0.0161, 0.0175, 0.0175,
		0.0202, 0.0177, 0.0189, 0.0175, 0.    , 0.0197, 0.02  , 0.0206,
		0.0206, 0.    , 0.    , 0.023 , 0.0215, 0.0223, 0.0229, 0.0221,
		0.022 , 0.    , 0.    , 0.0212, 0.0228, 0.0217, 0.023 , 0.0221,
		0.0229, 0.    , 0.0235, 0.    , 0.    , 0.0229, 0.    , 0.0216,
		0.0222, 0.0226, 0.0225, 0.023 , 0.0205, 0.0219, 0.    , 0.0226,
		0.0217, 0.021 , 0.    , 0.0224, 0.0217, 0.    , 0.    , 0.    ,
		0.0215, 0.0219, 0.0231, 0.0209, 0.0204, 0.0231, 0.0222, 0.0219,
		0.0208, 0.0217, 0.    , 0.0206, 0.0226, 0.021 , 0.0217, 0.0198,
		0.    , 0.    , 0.0202, 0.0211, 0.0211, 0.    , 0.0211, 0.    ,
		0.    , 0.    , 0.0195, 0.    , 0.0181, 0.0175, 0.0176, 0.    ,
		0.018 , 0.0182, 0.0174, 0.017 , 0.    , 0.0156, 0.0145, 0.    ,
		0.013 , 0.013 , 0.0124, 0.0107],
	   [0.0112, 0.    , 0.0133, 0.0141, 0.0175, 0.0174, 0.018 , 0.0163,
		0.0183, 0.019 , 0.0192, 0.0192, 0.0201, 0.0194, 0.0213, 0.02  ,
		0.0207, 0.0212, 0.0202, 0.022 , 0.0205, 0.0226, 0.0224, 0.0223,
		0.0231, 0.0242, 0.0205, 0.    , 0.021 , 0.0198, 0.    , 0.0216,
		0.    , 0.0217, 0.0218, 0.0228, 0.0207, 0.0217, 0.0223, 0.    ,
		0.    , 0.021 , 0.0217, 0.0229, 0.0206, 0.0237, 0.0209, 0.0223,
		0.    , 0.    , 0.0227, 0.0217, 0.    , 0.0214, 0.0211, 0.0212,
		0.0203, 0.0218, 0.    , 0.    , 0.    , 0.0218, 0.0216, 0.    ,
		0.0215, 0.0224, 0.0207, 0.0198, 0.0221, 0.021 , 0.0207, 0.0212,
		0.0207, 0.0205, 0.0206, 0.0215, 0.    , 0.0215, 0.    , 0.0199,
		0.0191, 0.0194, 0.018 , 0.0181, 0.0183, 0.0194, 0.0178, 0.0177,
		0.    , 0.0167, 0.    , 0.0166, 0.0147, 0.0162, 0.0168, 0.0145,
		0.    , 0.0124, 0.0119, 0.0108]],

	  [[0.0134, 0.0125, 0.0138, 0.0157, 0.016 , 0.0171, 0.017 , 0.    ,
		0.016 , 0.0182, 0.0181, 0.0185, 0.0196, 0.0194, 0.    , 0.    ,
		0.0196, 0.0206, 0.    , 0.0225, 0.    , 0.    , 0.0214, 0.    ,
		0.0227, 0.    , 0.    , 0.0207, 0.0229, 0.0233, 0.    , 0.022 ,
		0.0223, 0.    , 0.0226, 0.0218, 0.    , 0.019 , 0.0227, 0.0227,
		0.0208, 0.0232, 0.0234, 0.021 , 0.    , 0.0235, 0.0231, 0.0218,
		0.0226, 0.023 , 0.024 , 0.    , 0.0212, 0.0217, 0.    , 0.    ,
		0.0233, 0.0248, 0.    , 0.    , 0.0204, 0.0218, 0.0223, 0.    ,
		0.0214, 0.    , 0.0234, 0.0225, 0.0231, 0.0223, 0.0231, 0.0221,
		0.0213, 0.0213, 0.    , 0.    , 0.    , 0.0216, 0.0206, 0.0204,
		0.0198, 0.0197, 0.0202, 0.0209, 0.    , 0.0191, 0.0201, 0.    ,
		0.0167, 0.0165, 0.0183, 0.016 , 0.    , 0.0155, 0.    , 0.0148,
		0.0131, 0.0121, 0.0117, 0.0124],
	   [0.    , 0.0116, 0.    , 0.015 , 0.0176, 0.017 , 0.0184, 0.018 ,
		0.0181, 0.    , 0.    , 0.    , 0.0195, 0.0211, 0.0184, 0.0199,
		0.    , 0.    , 0.0206, 0.    , 0.0218, 0.0215, 0.022 , 0.0224,
		0.    , 0.0223, 0.022 , 0.0224, 0.0223, 0.    , 0.0221, 0.    ,
		0.    , 0.0224, 0.024 , 0.0223, 0.0237, 0.0231, 0.0235, 0.022 ,
		0.    , 0.0248, 0.0209, 0.    , 0.0211, 0.0216, 0.    , 0.0221,
		0.    , 0.0213, 0.0233, 0.0212, 0.    , 0.0222, 0.0234, 0.0227,
		0.0243, 0.    , 0.0218, 0.021 , 0.    , 0.0211, 0.0239, 0.0222,
		0.0231, 0.0219, 0.    , 0.022 , 0.022 , 0.    , 0.    , 0.0224,
		0.    , 0.    , 0.0224, 0.0211, 0.0216, 0.0223, 0.0216, 0.    ,
		0.0188, 0.0196, 0.0189, 0.0195, 0.0192, 0.019 , 0.0177, 0.0178,
		0.0157, 0.0166, 0.    , 0.0172, 0.0163, 0.0168, 0.016 , 0.0154,
		0.0135, 0.    , 0.0114, 0.0107],
	   [0.0126, 0.    , 0.0134, 0.0163, 0.0178, 0.0178, 0.0176, 0.0171,
		0.0166, 0.0171, 0.0169, 0.0174, 0.    , 0.    , 0.0207, 0.0197,
		0.0207, 0.0217, 0.0217, 0.0231, 0.0233, 0.0235, 0.0223, 0.021 ,
		0.0222, 0.0228, 0.022 , 0.    , 0.021 , 0.0242, 0.0238, 0.0222,
		0.0217, 0.0228, 0.0227, 0.    , 0.0218, 0.    , 0.    , 0.    ,
		0.0213, 0.    , 0.0215, 0.0207, 0.0219, 0.0213, 0.0227, 0.0219,
		0.0208, 0.    , 0.0203, 0.021 , 0.0224, 0.0228, 0.0236, 0.0231,
		0.0226, 0.0221, 0.0229, 0.0214, 0.0205, 0.022 , 0.0231, 0.0217,
		0.0222, 0.0219, 0.0227, 0.    , 0.0216, 0.0231, 0.0237, 0.0206,
		0.0207, 0.0228, 0.0218, 0.021 , 0.0207, 0.    , 0.    , 0.022 ,
		0.0186, 0.    , 0.    , 0.    , 0.0211, 0.0196, 0.    , 0.0186,
		0.    , 0.    , 0.0181, 0.    , 0.0161, 0.0162, 0.0153, 0.    ,
		0.0125, 0.0129, 0.    , 0.    ],
	   [0.0115, 0.0127, 0.0131, 0.    , 0.    , 0.    , 0.    , 0.0172,
		0.    , 0.0173, 0.0177, 0.0191, 0.0199, 0.019 , 0.0194, 0.0192,
		0.0206, 0.021 , 0.0221, 0.0229, 0.0199, 0.0212, 0.    , 0.0195,
		0.0233, 0.0225, 0.0215, 0.0209, 0.    , 0.0239, 0.0218, 0.0243,
		0.0228, 0.0215, 0.    , 0.0215, 0.0239, 0.0242, 0.0238, 0.021 ,
		0.0208, 0.0235, 0.    , 0.0207, 0.0223, 0.    , 0.0241, 0.    ,
		0.0234, 0.0227, 0.    , 0.0207, 0.0227, 0.    , 0.0212, 0.0221,
		0.    , 0.0225, 0.0221, 0.0211, 0.0208, 0.    , 0.    , 0.0208,
		0.    , 0.022 , 0.0232, 0.022 , 0.    , 0.0212, 0.0209, 0.    ,
		0.0229, 0.0229, 0.0202, 0.0229, 0.0198, 0.0208, 0.0229, 0.0219,
		0.    , 0.0193, 0.019 , 0.0182, 0.0197, 0.    , 0.0198, 0.0178,
		0.0179, 0.0177, 0.0181, 0.0177, 0.0164, 0.    , 0.016 , 0.0145,
		0.    , 0.0128, 0.0128, 0.011 ]]])

	model = DeepSEA(4, seq_len)
	precomputation = precompute(model, seq_len=seq_len, n_choices=4, alpha=4)
	isms = yuzu_ism(model, X, precomputation)
	assert_array_almost_equal(isms, deepsea_ism_scores, 3)

def test_basset():
	basset_ism_scores = numpy.array([
	  [[0.0045, 0.0044, 0.0041, 0.    , 0.    , 0.0047, 0.    , 0.    ,
        0.0067, 0.0065, 0.0067, 0.    , 0.0068, 0.0075, 0.    , 0.0081,
        0.    , 0.0088, 0.0079, 0.008 , 0.0077, 0.    , 0.    , 0.0085,
        0.    , 0.0075, 0.009 , 0.0092, 0.    , 0.    , 0.0076, 0.0071,
        0.0083, 0.008 , 0.    , 0.0086, 0.0079, 0.    , 0.0082, 0.0079,
        0.0085, 0.0097, 0.0079, 0.    , 0.0074, 0.0077, 0.0094, 0.007 ,
        0.0097, 0.0083, 0.0085, 0.0092, 0.0107, 0.0083, 0.0095, 0.0087,
        0.0079, 0.    , 0.0073, 0.0081, 0.0087, 0.0068, 0.0083, 0.0091,
        0.    , 0.0089, 0.0081, 0.    , 0.0088, 0.0079, 0.0098, 0.0085,
        0.0076, 0.009 , 0.    , 0.0085, 0.0069, 0.0093, 0.0082, 0.0073,
        0.0067, 0.0085, 0.    , 0.0068, 0.    , 0.    , 0.    , 0.0062,
        0.0057, 0.0067, 0.0053, 0.    , 0.0058, 0.    , 0.0056, 0.0048,
        0.0042, 0.    , 0.0043, 0.0039],
       [0.    , 0.0043, 0.0046, 0.0048, 0.0052, 0.    , 0.0046, 0.0063,
        0.    , 0.    , 0.    , 0.0061, 0.0072, 0.    , 0.008 , 0.    ,
        0.0062, 0.0084, 0.0071, 0.    , 0.    , 0.0089, 0.0077, 0.    ,
        0.0075, 0.0082, 0.0082, 0.0082, 0.0089, 0.0077, 0.008 , 0.    ,
        0.0085, 0.0085, 0.0094, 0.0087, 0.0087, 0.0084, 0.008 , 0.0097,
        0.0081, 0.    , 0.    , 0.0099, 0.    , 0.    , 0.0103, 0.    ,
        0.0084, 0.0085, 0.0086, 0.    , 0.01  , 0.0086, 0.0077, 0.0087,
        0.    , 0.0087, 0.0091, 0.01  , 0.009 , 0.    , 0.    , 0.009 ,
        0.0085, 0.    , 0.0087, 0.0091, 0.    , 0.    , 0.    , 0.    ,
        0.0085, 0.0078, 0.0081, 0.    , 0.0076, 0.0083, 0.0081, 0.007 ,
        0.0069, 0.0071, 0.0081, 0.0072, 0.0067, 0.0074, 0.0055, 0.006 ,
        0.0059, 0.    , 0.0051, 0.005 , 0.0059, 0.0051, 0.    , 0.0044,
        0.0043, 0.0039, 0.    , 0.    ],
       [0.0038, 0.0049, 0.    , 0.005 , 0.0049, 0.0053, 0.0051, 0.0054,
        0.0067, 0.0062, 0.0067, 0.0055, 0.    , 0.008 , 0.0084, 0.008 ,
        0.0061, 0.    , 0.    , 0.0087, 0.0073, 0.0091, 0.0088, 0.0076,
        0.0084, 0.    , 0.    , 0.0091, 0.008 , 0.0086, 0.0091, 0.0077,
        0.0094, 0.    , 0.0081, 0.    , 0.    , 0.0098, 0.    , 0.0088,
        0.0074, 0.0098, 0.0075, 0.0085, 0.0105, 0.008 , 0.    , 0.0088,
        0.0082, 0.0082, 0.    , 0.0083, 0.0098, 0.    , 0.    , 0.    ,
        0.0082, 0.009 , 0.009 , 0.0094, 0.0095, 0.0085, 0.0093, 0.0087,
        0.0087, 0.0087, 0.    , 0.0096, 0.0082, 0.0075, 0.0099, 0.0079,
        0.    , 0.    , 0.0083, 0.0084, 0.0079, 0.    , 0.008 , 0.    ,
        0.    , 0.    , 0.0083, 0.    , 0.0074, 0.0069, 0.0061, 0.    ,
        0.0057, 0.0072, 0.0056, 0.0069, 0.    , 0.0054, 0.0056, 0.    ,
        0.0047, 0.0043, 0.0037, 0.0038],
       [0.0041, 0.    , 0.0046, 0.0041, 0.005 , 0.0059, 0.0053, 0.0063,
        0.007 , 0.0064, 0.0067, 0.0066, 0.0068, 0.0076, 0.0074, 0.0075,
        0.0068, 0.0081, 0.0074, 0.0083, 0.0075, 0.0085, 0.0084, 0.0079,
        0.0077, 0.0086, 0.0083, 0.    , 0.008 , 0.0095, 0.    , 0.0083,
        0.    , 0.0079, 0.009 , 0.009 , 0.0091, 0.01  , 0.0086, 0.    ,
        0.    , 0.0093, 0.0097, 0.0098, 0.0097, 0.0069, 0.0083, 0.0078,
        0.    , 0.    , 0.0085, 0.0086, 0.    , 0.0088, 0.0095, 0.0094,
        0.0082, 0.0093, 0.    , 0.    , 0.    , 0.0088, 0.0091, 0.    ,
        0.0082, 0.0084, 0.008 , 0.0082, 0.0075, 0.0077, 0.0101, 0.0085,
        0.0086, 0.0077, 0.0076, 0.008 , 0.    , 0.0085, 0.    , 0.007 ,
        0.0069, 0.008 , 0.0074, 0.0071, 0.0074, 0.0067, 0.0063, 0.007 ,
        0.    , 0.0066, 0.    , 0.0054, 0.0052, 0.0052, 0.0047, 0.0053,
        0.    , 0.0039, 0.0034, 0.0038]],

      [[0.0043, 0.0046, 0.0046, 0.0055, 0.0047, 0.0053, 0.0056, 0.    ,
        0.0055, 0.0055, 0.0058, 0.0072, 0.0067, 0.0063, 0.    , 0.    ,
        0.0081, 0.0066, 0.    , 0.0078, 0.    , 0.    , 0.0072, 0.    ,
        0.0074, 0.    , 0.    , 0.0075, 0.0081, 0.0076, 0.    , 0.0083,
        0.0076, 0.    , 0.0089, 0.0074, 0.    , 0.0092, 0.0082, 0.007 ,
        0.0085, 0.0087, 0.008 , 0.0084, 0.    , 0.0097, 0.0084, 0.0087,
        0.0089, 0.0092, 0.0079, 0.    , 0.0091, 0.009 , 0.    , 0.    ,
        0.0092, 0.0083, 0.    , 0.    , 0.0086, 0.0082, 0.009 , 0.    ,
        0.0088, 0.    , 0.0083, 0.0092, 0.0078, 0.0094, 0.0078, 0.008 ,
        0.0092, 0.0077, 0.    , 0.    , 0.    , 0.0072, 0.0084, 0.0077,
        0.0087, 0.0086, 0.0078, 0.0076, 0.    , 0.0066, 0.0074, 0.    ,
        0.0063, 0.0073, 0.0052, 0.006 , 0.    , 0.0059, 0.    , 0.0044,
        0.0045, 0.0042, 0.0042, 0.0042],
       [0.    , 0.0043, 0.    , 0.0041, 0.0056, 0.0056, 0.0064, 0.0059,
        0.007 , 0.    , 0.    , 0.    , 0.0072, 0.0087, 0.0069, 0.0061,
        0.    , 0.    , 0.0074, 0.    , 0.0071, 0.0074, 0.0092, 0.0104,
        0.    , 0.0084, 0.0077, 0.0086, 0.0071, 0.    , 0.0083, 0.    ,
        0.    , 0.0085, 0.0074, 0.0085, 0.0087, 0.0097, 0.0082, 0.008 ,
        0.    , 0.0094, 0.009 , 0.    , 0.0089, 0.0081, 0.    , 0.0079,
        0.    , 0.0091, 0.0094, 0.0092, 0.    , 0.0085, 0.0076, 0.0077,
        0.0084, 0.    , 0.0065, 0.008 , 0.    , 0.0091, 0.0088, 0.0087,
        0.0086, 0.0088, 0.    , 0.0088, 0.0089, 0.    , 0.    , 0.0081,
        0.    , 0.    , 0.0082, 0.0074, 0.007 , 0.0082, 0.0075, 0.    ,
        0.0075, 0.0066, 0.0065, 0.0067, 0.0066, 0.0079, 0.0067, 0.0062,
        0.0057, 0.0068, 0.    , 0.0056, 0.0061, 0.0056, 0.0059, 0.005 ,
        0.0048, 0.    , 0.0043, 0.0042],
       [0.0036, 0.    , 0.0041, 0.0046, 0.0049, 0.0051, 0.006 , 0.0054,
        0.0062, 0.006 , 0.0058, 0.0067, 0.    , 0.    , 0.0076, 0.0065,
        0.008 , 0.0052, 0.008 , 0.008 , 0.0065, 0.0073, 0.0086, 0.009 ,
        0.0073, 0.0095, 0.0081, 0.    , 0.0095, 0.0089, 0.0086, 0.0076,
        0.0083, 0.0083, 0.0091, 0.    , 0.0075, 0.    , 0.    , 0.    ,
        0.0091, 0.    , 0.0075, 0.0087, 0.0089, 0.0088, 0.0094, 0.0086,
        0.0077, 0.    , 0.0084, 0.0088, 0.0089, 0.0089, 0.009 , 0.0082,
        0.0084, 0.0073, 0.0076, 0.0096, 0.0078, 0.0081, 0.0074, 0.0084,
        0.0084, 0.0074, 0.0075, 0.    , 0.008 , 0.0086, 0.008 , 0.0068,
        0.0086, 0.0074, 0.0076, 0.0082, 0.0088, 0.    , 0.    , 0.0069,
        0.0082, 0.    , 0.    , 0.    , 0.0065, 0.0062, 0.    , 0.0064,
        0.    , 0.    , 0.0055, 0.    , 0.0059, 0.0063, 0.0054, 0.    ,
        0.0053, 0.0046, 0.    , 0.    ],
       [0.0039, 0.0052, 0.0047, 0.    , 0.    , 0.    , 0.    , 0.006 ,
        0.    , 0.0063, 0.0063, 0.0064, 0.0074, 0.0069, 0.0069, 0.0076,
        0.0073, 0.0056, 0.0077, 0.008 , 0.0076, 0.0085, 0.    , 0.0082,
        0.0086, 0.0097, 0.0081, 0.008 , 0.    , 0.0085, 0.0075, 0.0082,
        0.0067, 0.0082, 0.    , 0.0089, 0.0077, 0.0083, 0.0078, 0.0087,
        0.0099, 0.0092, 0.    , 0.0097, 0.0089, 0.    , 0.0073, 0.    ,
        0.008 , 0.0097, 0.    , 0.008 , 0.0101, 0.    , 0.0088, 0.0077,
        0.    , 0.0085, 0.0078, 0.008 , 0.0083, 0.    , 0.    , 0.0076,
        0.    , 0.0066, 0.0078, 0.0065, 0.    , 0.0099, 0.0076, 0.    ,
        0.0077, 0.0069, 0.0086, 0.0074, 0.008 , 0.0082, 0.0068, 0.0072,
        0.    , 0.0073, 0.0082, 0.0074, 0.0067, 0.    , 0.0069, 0.0062,
        0.0059, 0.0072, 0.0051, 0.0055, 0.0056, 0.    , 0.0058, 0.005 ,
        0.    , 0.0042, 0.0038, 0.0042]]])

	model = Basset(4, seq_len)
	precomputation = precompute(model, seq_len=seq_len, n_choices=4, alpha=4)
	isms = yuzu_ism(model, X, precomputation)
	assert_array_almost_equal(isms, basset_ism_scores, 3)

def test_factorized_basset():
	factorized_basset_ism_scores = numpy.array([
      [[1.06e-06, 7.00e-08, 3.00e-07, 0.00e+00, 0.00e+00, 1.53e-06,
        0.00e+00, 0.00e+00, 4.50e-07, 1.45e-06, 1.08e-06, 0.00e+00,
        6.90e-07, 7.40e-07, 0.00e+00, 1.10e-07, 0.00e+00, 2.56e-06,
        1.22e-06, 7.20e-07, 3.00e-08, 0.00e+00, 0.00e+00, 1.92e-06,
        0.00e+00, 6.40e-07, 2.18e-06, 3.68e-06, 0.00e+00, 0.00e+00,
        1.29e-06, 1.03e-06, 1.30e-06, 1.77e-06, 0.00e+00, 3.60e-07,
        3.60e-07, 0.00e+00, 8.70e-07, 1.06e-06, 1.94e-06, 2.47e-06,
        3.24e-06, 0.00e+00, 6.00e-08, 1.82e-06, 1.39e-06, 2.44e-06,
        7.20e-07, 2.70e-06, 2.26e-06, 1.90e-07, 1.80e-07, 9.90e-07,
        1.25e-06, 1.32e-06, 1.39e-06, 0.00e+00, 2.00e-07, 1.79e-06,
        1.90e-06, 1.65e-06, 1.58e-06, 2.40e-07, 0.00e+00, 8.20e-07,
        1.80e-06, 0.00e+00, 1.20e-06, 1.86e-06, 2.33e-06, 9.20e-07,
        3.37e-06, 2.89e-06, 0.00e+00, 1.78e-06, 1.40e-06, 5.20e-07,
        6.60e-07, 2.03e-06, 4.60e-07, 1.16e-06, 0.00e+00, 1.26e-06,
        0.00e+00, 0.00e+00, 0.00e+00, 1.80e-07, 1.65e-06, 2.40e-06,
        7.30e-07, 0.00e+00, 2.87e-06, 0.00e+00, 6.20e-07, 5.20e-07,
        1.70e-07, 0.00e+00, 9.80e-07, 5.10e-07],
       [0.00e+00, 2.50e-07, 1.19e-06, 1.17e-06, 1.15e-06, 0.00e+00,
        1.24e-06, 4.00e-07, 0.00e+00, 0.00e+00, 0.00e+00, 7.00e-08,
        1.53e-06, 0.00e+00, 1.33e-06, 0.00e+00, 1.30e-07, 4.60e-07,
        5.00e-08, 0.00e+00, 0.00e+00, 4.20e-06, 1.29e-06, 0.00e+00,
        7.70e-07, 2.90e-06, 1.76e-06, 2.82e-06, 2.20e-07, 5.30e-07,
        3.10e-07, 0.00e+00, 0.00e+00, 2.56e-06, 1.60e-07, 7.30e-07,
        5.90e-07, 1.50e-07, 1.43e-06, 5.80e-07, 2.20e-06, 0.00e+00,
        0.00e+00, 7.30e-07, 0.00e+00, 0.00e+00, 2.40e-06, 0.00e+00,
        1.22e-06, 3.68e-06, 1.58e-06, 0.00e+00, 9.00e-07, 1.00e-07,
        6.00e-08, 1.16e-06, 0.00e+00, 2.90e-07, 4.00e-08, 3.50e-07,
        9.50e-07, 0.00e+00, 0.00e+00, 1.55e-06, 1.84e-06, 0.00e+00,
        2.10e-07, 1.70e-06, 0.00e+00, 0.00e+00, 0.00e+00, 0.00e+00,
        1.65e-06, 1.60e-06, 2.77e-06, 0.00e+00, 7.00e-07, 3.30e-07,
        3.30e-07, 5.00e-07, 5.00e-07, 4.60e-07, 2.08e-06, 2.50e-07,
        3.10e-07, 1.96e-06, 1.20e-06, 7.00e-07, 1.27e-06, 0.00e+00,
        1.26e-06, 2.80e-07, 4.50e-07, 4.00e-08, 0.00e+00, 1.14e-06,
        1.96e-06, 5.70e-07, 0.00e+00, 0.00e+00],
       [5.70e-07, 6.90e-07, 0.00e+00, 3.70e-07, 5.00e-08, 4.70e-07,
        5.80e-07, 1.08e-06, 1.96e-06, 1.66e-06, 1.20e-06, 1.78e-06,
        0.00e+00, 1.87e-06, 1.90e-07, 8.30e-07, 0.00e+00, 0.00e+00,
        0.00e+00, 1.20e-07, 1.10e-07, 2.61e-06, 6.00e-07, 1.26e-06,
        5.10e-07, 0.00e+00, 0.00e+00, 4.07e-06, 3.50e-07, 6.60e-07,
        1.70e-07, 7.70e-07, 6.50e-07, 0.00e+00, 3.50e-07, 0.00e+00,
        0.00e+00, 2.60e-07, 0.00e+00, 2.72e-06, 3.82e-06, 1.39e-06,
        1.67e-06, 1.00e-07, 3.31e-06, 3.20e-07, 0.00e+00, 2.57e-06,
        1.93e-06, 2.71e-06, 0.00e+00, 1.03e-06, 1.04e-06, 0.00e+00,
        0.00e+00, 0.00e+00, 1.75e-06, 7.10e-07, 1.84e-06, 3.12e-06,
        6.00e-07, 1.60e-07, 1.05e-06, 1.18e-06, 8.80e-07, 1.30e-06,
        0.00e+00, 8.00e-08, 1.01e-06, 1.69e-06, 0.00e+00, 7.20e-07,
        0.00e+00, 0.00e+00, 3.33e-06, 2.16e-06, 1.62e-06, 0.00e+00,
        2.90e-07, 0.00e+00, 0.00e+00, 0.00e+00, 5.90e-07, 0.00e+00,
        8.00e-08, 7.30e-07, 2.43e-06, 0.00e+00, 1.37e-06, 2.07e-06,
        1.45e-06, 1.02e-06, 0.00e+00, 1.80e-07, 1.40e-06, 0.00e+00,
        5.80e-07, 1.21e-06, 3.30e-07, 1.80e-07],
       [1.36e-06, 0.00e+00, 6.80e-07, 2.00e-08, 2.70e-07, 1.30e-06,
        1.76e-06, 4.50e-07, 7.10e-07, 9.00e-08, 6.00e-07, 2.83e-06,
        7.00e-07, 1.49e-06, 1.36e-06, 5.10e-07, 2.00e-07, 2.15e-06,
        3.20e-07, 1.52e-06, 6.60e-07, 1.24e-06, 5.81e-06, 1.50e-06,
        3.60e-07, 1.83e-06, 9.30e-07, 0.00e+00, 2.30e-06, 2.88e-06,
        0.00e+00, 3.80e-07, 0.00e+00, 7.50e-07, 2.70e-07, 2.35e-06,
        1.34e-06, 8.20e-07, 2.57e-06, 0.00e+00, 0.00e+00, 4.68e-06,
        1.69e-06, 1.21e-06, 1.97e-06, 1.00e-06, 1.74e-06, 1.81e-06,
        0.00e+00, 0.00e+00, 1.29e-06, 8.80e-07, 0.00e+00, 1.04e-06,
        1.05e-06, 2.88e-06, 6.20e-07, 3.21e-06, 0.00e+00, 0.00e+00,
        0.00e+00, 2.80e-07, 1.06e-06, 0.00e+00, 2.49e-06, 5.10e-07,
        3.16e-06, 1.68e-06, 1.33e-06, 1.79e-06, 2.03e-06, 3.12e-06,
        1.34e-06, 6.00e-07, 2.04e-06, 3.03e-06, 0.00e+00, 7.00e-07,
        0.00e+00, 9.80e-07, 3.30e-07, 9.80e-07, 1.87e-06, 4.40e-07,
        7.90e-07, 1.04e-06, 1.15e-06, 4.40e-07, 0.00e+00, 7.60e-07,
        0.00e+00, 1.73e-06, 7.50e-07, 1.09e-06, 7.50e-07, 5.40e-07,
        0.00e+00, 1.20e-07, 9.80e-07, 4.60e-07]],

      [[1.80e-07, 2.90e-07, 1.47e-06, 2.06e-06, 2.90e-07, 1.36e-06,
        3.29e-06, 0.00e+00, 4.20e-07, 2.15e-06, 6.60e-07, 1.83e-06,
        2.23e-06, 1.58e-06, 0.00e+00, 0.00e+00, 4.90e-07, 6.30e-07,
        0.00e+00, 2.70e-07, 0.00e+00, 0.00e+00, 2.10e-07, 0.00e+00,
        1.04e-06, 0.00e+00, 0.00e+00, 9.00e-07, 5.00e-08, 1.46e-06,
        0.00e+00, 1.70e-06, 1.38e-06, 0.00e+00, 2.18e-06, 3.18e-06,
        0.00e+00, 2.19e-06, 1.55e-06, 1.30e-07, 3.04e-06, 5.73e-06,
        5.00e-07, 1.90e-06, 0.00e+00, 4.77e-06, 6.30e-07, 1.59e-06,
        2.73e-06, 5.10e-07, 1.98e-06, 0.00e+00, 2.47e-06, 3.27e-06,
        0.00e+00, 0.00e+00, 4.81e-06, 1.63e-06, 0.00e+00, 0.00e+00,
        1.10e-06, 7.00e-07, 1.96e-06, 0.00e+00, 1.76e-06, 0.00e+00,
        2.00e-08, 5.10e-07, 6.80e-07, 6.00e-07, 1.05e-06, 1.07e-06,
        9.30e-07, 8.00e-07, 0.00e+00, 0.00e+00, 0.00e+00, 9.00e-08,
        1.65e-06, 3.64e-06, 1.73e-06, 1.04e-06, 9.80e-07, 4.30e-07,
        0.00e+00, 3.90e-07, 2.46e-06, 0.00e+00, 3.40e-07, 1.59e-06,
        1.02e-06, 1.50e-06, 0.00e+00, 1.52e-06, 0.00e+00, 5.30e-07,
        5.20e-07, 6.50e-07, 9.10e-07, 8.50e-07],
       [0.00e+00, 8.20e-07, 0.00e+00, 1.73e-06, 7.20e-07, 2.23e-06,
        4.30e-07, 2.46e-06, 9.80e-07, 0.00e+00, 0.00e+00, 0.00e+00,
        2.20e-07, 7.10e-07, 2.91e-06, 1.38e-06, 0.00e+00, 0.00e+00,
        7.80e-07, 0.00e+00, 3.00e-06, 3.90e-07, 2.00e-07, 1.11e-06,
        0.00e+00, 9.00e-08, 2.85e-06, 3.86e-06, 3.20e-07, 0.00e+00,
        1.26e-06, 0.00e+00, 0.00e+00, 5.70e-07, 3.30e-06, 1.67e-06,
        1.61e-06, 1.83e-06, 0.00e+00, 1.84e-06, 0.00e+00, 4.01e-06,
        8.50e-07, 0.00e+00, 1.09e-06, 3.28e-06, 0.00e+00, 1.20e-07,
        0.00e+00, 1.22e-06, 2.80e-06, 3.44e-06, 0.00e+00, 2.48e-06,
        2.18e-06, 1.59e-06, 4.88e-06, 0.00e+00, 3.95e-06, 2.90e-07,
        0.00e+00, 1.34e-06, 0.00e+00, 3.34e-06, 1.32e-06, 1.22e-06,
        0.00e+00, 2.70e-06, 4.30e-07, 0.00e+00, 0.00e+00, 9.30e-07,
        0.00e+00, 0.00e+00, 9.80e-07, 1.07e-06, 2.58e-06, 6.60e-07,
        9.00e-08, 0.00e+00, 6.50e-07, 6.00e-07, 2.26e-06, 8.70e-07,
        7.00e-08, 1.16e-06, 9.40e-07, 8.30e-07, 1.20e-07, 1.00e-07,
        0.00e+00, 8.50e-07, 4.50e-07, 1.84e-06, 6.30e-07, 2.70e-07,
        2.10e-07, 0.00e+00, 1.87e-06, 6.30e-07],
       [2.90e-07, 0.00e+00, 5.00e-07, 1.98e-06, 1.70e-07, 1.90e-07,
        8.90e-07, 4.00e-07, 7.70e-07, 2.35e-06, 2.65e-06, 3.15e-06,
        0.00e+00, 0.00e+00, 5.60e-07, 1.24e-06, 8.40e-07, 1.52e-06,
        2.60e-07, 7.10e-07, 1.48e-06, 1.39e-06, 1.50e-06, 1.10e-07,
        9.80e-07, 1.00e-07, 2.10e-07, 0.00e+00, 4.60e-07, 7.10e-07,
        1.04e-06, 7.90e-07, 1.40e-07, 5.70e-07, 2.48e-06, 0.00e+00,
        4.89e-06, 0.00e+00, 0.00e+00, 0.00e+00, 1.35e-06, 0.00e+00,
        9.30e-07, 2.35e-06, 2.20e-07, 1.21e-06, 1.70e-07, 3.29e-06,
        1.10e-06, 0.00e+00, 5.70e-07, 1.23e-06, 6.20e-07, 3.76e-06,
        3.83e-06, 2.35e-06, 3.22e-06, 2.82e-06, 5.36e-06, 2.87e-06,
        7.20e-07, 3.54e-06, 2.00e-08, 6.40e-07, 3.00e-08, 4.00e-07,
        2.86e-06, 0.00e+00, 7.90e-07, 1.82e-06, 2.50e-07, 8.30e-07,
        6.00e-08, 1.07e-06, 1.11e-06, 1.90e-07, 7.00e-08, 0.00e+00,
        0.00e+00, 1.10e-06, 1.90e-06, 0.00e+00, 0.00e+00, 0.00e+00,
        1.95e-06, 1.94e-06, 0.00e+00, 7.00e-08, 0.00e+00, 0.00e+00,
        2.30e-07, 0.00e+00, 1.79e-06, 2.37e-06, 2.40e-07, 0.00e+00,
        7.70e-07, 1.00e-08, 0.00e+00, 0.00e+00],
       [7.00e-08, 9.70e-07, 9.20e-07, 0.00e+00, 0.00e+00, 0.00e+00,
        0.00e+00, 1.63e-06, 0.00e+00, 6.50e-07, 1.50e-07, 6.00e-08,
        9.20e-07, 2.40e-07, 2.03e-06, 1.95e-06, 1.59e-06, 4.00e-08,
        1.80e-07, 3.50e-07, 2.46e-06, 1.00e-08, 0.00e+00, 4.50e-07,
        1.38e-06, 6.60e-07, 1.37e-06, 2.70e-07, 0.00e+00, 1.90e-06,
        9.00e-08, 1.09e-06, 1.76e-06, 3.20e-07, 0.00e+00, 3.09e-06,
        3.88e-06, 1.09e-06, 1.47e-06, 3.56e-06, 2.23e-06, 3.63e-06,
        0.00e+00, 1.26e-06, 6.90e-07, 0.00e+00, 1.15e-06, 0.00e+00,
        3.86e-06, 1.31e-06, 0.00e+00, 3.22e-06, 1.61e-06, 0.00e+00,
        2.84e-06, 2.34e-06, 0.00e+00, 3.60e-07, 3.12e-06, 1.83e-06,
        6.60e-07, 0.00e+00, 0.00e+00, 1.59e-06, 0.00e+00, 2.00e-08,
        2.70e-07, 1.88e-06, 0.00e+00, 3.00e-08, 2.00e-06, 0.00e+00,
        2.52e-06, 2.32e-06, 1.80e-07, 8.90e-07, 3.70e-07, 8.20e-07,
        1.14e-06, 1.35e-06, 0.00e+00, 8.50e-07, 1.88e-06, 1.42e-06,
        5.30e-07, 0.00e+00, 1.09e-06, 7.40e-07, 2.60e-07, 4.00e-08,
        1.88e-06, 1.15e-06, 7.20e-07, 0.00e+00, 3.20e-07, 2.24e-06,
        0.00e+00, 8.20e-07, 1.85e-06, 7.10e-07]]])

	model = FactorizedBasset(4, seq_len)
	precomputation = precompute(model, seq_len=seq_len, n_choices=4, alpha=4)
	isms = yuzu_ism(model, X, precomputation)
	assert_array_almost_equal(isms, factorized_basset_ism_scores, 3)

def test_bpnet():
	bpnet_ism_scores = numpy.array([
	  [[0.0053, 0.0051, 0.0064, 0.    , 0.    , 0.0064, 0.    , 0.    ,
		0.0065, 0.0082, 0.008 , 0.    , 0.01  , 0.0088, 0.    , 0.0099,
		0.    , 0.009 , 0.0082, 0.01  , 0.0083, 0.    , 0.    , 0.0087,
		0.    , 0.0094, 0.0101, 0.0088, 0.    , 0.    , 0.0089, 0.009 ,
		0.0095, 0.0112, 0.    , 0.0098, 0.0089, 0.    , 0.0105, 0.009 ,
		0.0075, 0.0114, 0.0126, 0.    , 0.0105, 0.0118, 0.0105, 0.0101,
		0.0096, 0.0085, 0.0112, 0.0097, 0.0091, 0.011 , 0.0102, 0.0113,
		0.0096, 0.    , 0.0094, 0.0097, 0.0092, 0.0094, 0.0107, 0.0089,
		0.    , 0.0092, 0.0101, 0.    , 0.0092, 0.0098, 0.0101, 0.0097,
		0.0094, 0.0095, 0.    , 0.01  , 0.0084, 0.0091, 0.0077, 0.0095,
		0.0102, 0.0086, 0.    , 0.0075, 0.    , 0.    , 0.    , 0.0094,
		0.0069, 0.0069, 0.0072, 0.    , 0.0072, 0.    , 0.0062, 0.0073,
		0.0054, 0.    , 0.0046, 0.0042],
	   [0.    , 0.0049, 0.006 , 0.0066, 0.0063, 0.    , 0.0074, 0.007 ,
		0.    , 0.    , 0.    , 0.0085, 0.0094, 0.    , 0.0089, 0.    ,
		0.009 , 0.0092, 0.008 , 0.    , 0.    , 0.0082, 0.0083, 0.    ,
		0.0098, 0.0093, 0.0103, 0.0099, 0.01  , 0.0096, 0.0104, 0.    ,
		0.009 , 0.0104, 0.0108, 0.009 , 0.0091, 0.0103, 0.0106, 0.0089,
		0.0101, 0.    , 0.    , 0.0121, 0.    , 0.    , 0.0108, 0.    ,
		0.0112, 0.0107, 0.0113, 0.    , 0.0095, 0.0097, 0.0108, 0.0095,
		0.    , 0.0093, 0.009 , 0.0116, 0.0105, 0.    , 0.    , 0.0098,
		0.009 , 0.    , 0.0083, 0.009 , 0.    , 0.    , 0.    , 0.    ,
		0.0085, 0.0104, 0.0086, 0.    , 0.0087, 0.0094, 0.0076, 0.0081,
		0.011 , 0.0077, 0.0099, 0.0089, 0.0085, 0.0076, 0.0084, 0.0074,
		0.0074, 0.    , 0.0057, 0.0052, 0.0063, 0.0063, 0.    , 0.0058,
		0.0059, 0.0055, 0.    , 0.    ],
	   [0.006 , 0.0061, 0.    , 0.0054, 0.0051, 0.0062, 0.0063, 0.0072,
		0.0075, 0.008 , 0.0077, 0.0075, 0.    , 0.0072, 0.0098, 0.0089,
		0.0088, 0.    , 0.    , 0.0092, 0.008 , 0.0089, 0.0104, 0.0104,
		0.0106, 0.    , 0.    , 0.0097, 0.0108, 0.0096, 0.0112, 0.0092,
		0.0103, 0.    , 0.0119, 0.    , 0.    , 0.0111, 0.    , 0.0097,
		0.01  , 0.0126, 0.0124, 0.0114, 0.0112, 0.0115, 0.    , 0.0105,
		0.0124, 0.0109, 0.    , 0.0099, 0.0091, 0.    , 0.    , 0.    ,
		0.01  , 0.0102, 0.0103, 0.0104, 0.0107, 0.0102, 0.0111, 0.0092,
		0.0086, 0.0095, 0.    , 0.0094, 0.0097, 0.0108, 0.0094, 0.0088,
		0.    , 0.    , 0.0107, 0.0118, 0.0111, 0.    , 0.0088, 0.    ,
		0.    , 0.    , 0.0083, 0.    , 0.0095, 0.0082, 0.01  , 0.    ,
		0.0078, 0.0074, 0.0072, 0.0066, 0.    , 0.0059, 0.0064, 0.    ,
		0.0057, 0.0055, 0.0058, 0.0045],
	   [0.0051, 0.    , 0.0067, 0.0053, 0.0061, 0.007 , 0.0069, 0.0063,
		0.0087, 0.0088, 0.0078, 0.0073, 0.0095, 0.0091, 0.0081, 0.009 ,
		0.0103, 0.0083, 0.0081, 0.0094, 0.0088, 0.0074, 0.0082, 0.009 ,
		0.0098, 0.0088, 0.01  , 0.    , 0.0099, 0.0096, 0.    , 0.0103,
		0.    , 0.0105, 0.0102, 0.0093, 0.0098, 0.0105, 0.011 , 0.    ,
		0.    , 0.0115, 0.0097, 0.01  , 0.0102, 0.0111, 0.0102, 0.0096,
		0.    , 0.    , 0.011 , 0.0093, 0.    , 0.0102, 0.0104, 0.0113,
		0.0105, 0.0099, 0.    , 0.    , 0.    , 0.0085, 0.0103, 0.    ,
		0.0088, 0.0098, 0.0099, 0.0084, 0.0097, 0.0101, 0.0084, 0.0082,
		0.009 , 0.0088, 0.008 , 0.0093, 0.    , 0.0099, 0.    , 0.0085,
		0.0096, 0.0067, 0.0094, 0.0083, 0.0084, 0.0078, 0.0071, 0.0087,
		0.    , 0.0077, 0.    , 0.0081, 0.0068, 0.0069, 0.0071, 0.0064,
		0.    , 0.0043, 0.0054, 0.0036]],

	  [[0.0064, 0.0062, 0.0051, 0.0046, 0.0061, 0.0051, 0.0071, 0.    ,
		0.0071, 0.0082, 0.0088, 0.0066, 0.0081, 0.007 , 0.    , 0.    ,
		0.0103, 0.0089, 0.    , 0.0084, 0.    , 0.    , 0.0088, 0.    ,
		0.0089, 0.    , 0.    , 0.0086, 0.0083, 0.0111, 0.    , 0.0101,
		0.0104, 0.    , 0.0092, 0.0113, 0.    , 0.0108, 0.0115, 0.0105,
		0.01  , 0.0102, 0.0105, 0.0098, 0.    , 0.0095, 0.0107, 0.0107,
		0.01  , 0.0099, 0.0102, 0.    , 0.0102, 0.0115, 0.    , 0.    ,
		0.0104, 0.0108, 0.    , 0.    , 0.0088, 0.0119, 0.0091, 0.    ,
		0.0106, 0.    , 0.0101, 0.0106, 0.0087, 0.0097, 0.0091, 0.0083,
		0.0092, 0.009 , 0.    , 0.    , 0.    , 0.0088, 0.0098, 0.0082,
		0.0087, 0.0095, 0.0094, 0.0092, 0.    , 0.0074, 0.0084, 0.    ,
		0.0081, 0.0073, 0.007 , 0.008 , 0.    , 0.0064, 0.    , 0.0065,
		0.006 , 0.0048, 0.006 , 0.0057],
	   [0.    , 0.0052, 0.    , 0.006 , 0.0077, 0.0067, 0.0071, 0.007 ,
		0.0065, 0.    , 0.    , 0.    , 0.0072, 0.0084, 0.0094, 0.0085,
		0.    , 0.    , 0.0101, 0.    , 0.0086, 0.0078, 0.0086, 0.0085,
		0.    , 0.0091, 0.0087, 0.0097, 0.0093, 0.    , 0.0098, 0.    ,
		0.    , 0.0098, 0.0097, 0.0107, 0.0112, 0.0114, 0.01  , 0.0094,
		0.    , 0.0095, 0.0101, 0.    , 0.0111, 0.01  , 0.    , 0.011 ,
		0.    , 0.0103, 0.0095, 0.0099, 0.    , 0.0101, 0.0106, 0.011 ,
		0.0097, 0.    , 0.0111, 0.0103, 0.    , 0.0104, 0.0091, 0.01  ,
		0.0094, 0.0103, 0.    , 0.0092, 0.008 , 0.    , 0.    , 0.0095,
		0.    , 0.    , 0.0098, 0.0091, 0.0083, 0.0084, 0.0099, 0.    ,
		0.0092, 0.0086, 0.0093, 0.0108, 0.0075, 0.0074, 0.0084, 0.0085,
		0.009 , 0.0074, 0.    , 0.0068, 0.0067, 0.0059, 0.0065, 0.0056,
		0.0055, 0.    , 0.0049, 0.0053],
	   [0.0057, 0.    , 0.006 , 0.0065, 0.0063, 0.0063, 0.0071, 0.0068,
		0.0083, 0.0082, 0.0081, 0.0076, 0.    , 0.    , 0.01  , 0.0076,
		0.0082, 0.0082, 0.0082, 0.01  , 0.0088, 0.0079, 0.0092, 0.0094,
		0.0091, 0.0087, 0.01  , 0.    , 0.0101, 0.0099, 0.0108, 0.0102,
		0.0102, 0.011 , 0.0107, 0.    , 0.0107, 0.    , 0.    , 0.    ,
		0.01  , 0.    , 0.0123, 0.01  , 0.0116, 0.0105, 0.0109, 0.0098,
		0.0085, 0.    , 0.0096, 0.0097, 0.0113, 0.0112, 0.0096, 0.0102,
		0.0101, 0.0091, 0.0104, 0.0099, 0.0097, 0.0109, 0.01  , 0.0098,
		0.0098, 0.0094, 0.0095, 0.    , 0.0083, 0.0074, 0.0091, 0.0098,
		0.0087, 0.0089, 0.0096, 0.01  , 0.0095, 0.    , 0.    , 0.0089,
		0.0099, 0.    , 0.    , 0.    , 0.0092, 0.0074, 0.    , 0.009 ,
		0.    , 0.    , 0.0066, 0.    , 0.0081, 0.0053, 0.0083, 0.    ,
		0.0049, 0.0054, 0.    , 0.    ],
	   [0.006 , 0.0074, 0.0055, 0.    , 0.    , 0.    , 0.    , 0.0073,
		0.    , 0.0087, 0.0079, 0.0084, 0.0078, 0.0077, 0.0084, 0.0076,
		0.0084, 0.0083, 0.0095, 0.0107, 0.0091, 0.0081, 0.    , 0.0094,
		0.0094, 0.0077, 0.0097, 0.0099, 0.    , 0.0112, 0.0079, 0.0084,
		0.0089, 0.0096, 0.    , 0.0104, 0.0103, 0.0119, 0.0107, 0.011 ,
		0.0105, 0.0107, 0.    , 0.0104, 0.0105, 0.    , 0.0109, 0.    ,
		0.0098, 0.0102, 0.    , 0.0093, 0.0091, 0.    , 0.0097, 0.0094,
		0.    , 0.0108, 0.0106, 0.0094, 0.0116, 0.    , 0.    , 0.0105,
		0.    , 0.009 , 0.0084, 0.0097, 0.    , 0.0078, 0.0092, 0.    ,
		0.0097, 0.0093, 0.0082, 0.0097, 0.0089, 0.0081, 0.0096, 0.008 ,
		0.    , 0.0087, 0.0084, 0.0104, 0.008 , 0.    , 0.0092, 0.0087,
		0.0073, 0.0066, 0.0056, 0.0065, 0.0079, 0.    , 0.0071, 0.0073,
		0.    , 0.0045, 0.006 , 0.0053]]])


	model = BPNet(4, seq_len)
	precomputation = precompute(model, seq_len=seq_len, n_choices=4, alpha=4)
	isms = yuzu_ism(model, X, precomputation)
	assert_array_almost_equal(isms, bpnet_ism_scores, 3)

###

def test_small_probes_one_layer():
	one_layer_ism_scores = numpy.array([
	  [[3.2185, 3.3727, 3.6229, 0.    , 0.    , 4.1827, 0.    , 0.    ,
        4.2054, 4.1871, 4.2112, 0.    , 3.9904, 4.4655, 0.    , 4.2532,
        0.    , 3.8876, 3.8738, 4.2213, 4.2293, 0.    , 0.    , 4.2081,
        0.    , 3.9   , 3.9013, 3.9887, 0.    , 0.    , 3.9896, 4.2086,
        3.99  , 3.9001, 0.    , 3.9002, 3.9001, 0.    , 3.9   , 3.9898,
        3.9899, 4.2089, 4.2076, 0.    , 4.2081, 4.2084, 3.8968, 4.2082,
        3.9885, 3.9898, 3.9081, 4.2081, 3.9893, 3.8997, 3.9   , 3.9   ,
        4.2083, 0.    , 3.9899, 3.9899, 3.9899, 4.2084, 4.2085, 3.9899,
        0.    , 4.2083, 3.9113, 0.    , 4.2108, 4.213 , 4.2624, 4.178 ,
        3.8926, 3.9072, 0.    , 4.2103, 3.986 , 3.9031, 3.9897, 3.9   ,
        3.8999, 3.8933, 0.    , 3.9   , 0.    , 0.    , 0.    , 3.8789,
        4.0034, 4.2078, 4.0241, 0.    , 3.9   , 0.    , 4.2084, 3.9   ,
        3.9899, 0.    , 3.5001, 3.1382],
       [0.    , 3.4442, 3.8299, 4.2046, 4.2446, 0.    , 4.2306, 4.2016,
        0.    , 0.    , 0.    , 4.5987, 4.4677, 0.    , 4.4068, 0.    ,
        4.2467, 4.0659, 4.0288, 0.    , 0.    , 4.1668, 4.2105, 0.    ,
        4.2126, 4.0394, 4.0413, 4.0572, 4.2085, 4.2044, 4.0573, 0.    ,
        4.057 , 4.0383, 4.2081, 4.0391, 4.0387, 4.2084, 4.0387, 4.0571,
        4.057 , 0.    , 0.    , 4.2081, 0.    , 0.    , 4.0379, 0.    ,
        4.0575, 4.0565, 4.0403, 0.    , 4.0578, 4.0389, 4.0388, 4.0386,
        0.    , 4.2086, 4.0569, 4.0569, 4.0571, 0.    , 0.    , 4.0571,
        4.2084, 0.    , 4.0411, 4.2152, 0.    , 0.    , 0.    , 0.    ,
        4.0538, 4.0392, 4.1228, 0.    , 4.0568, 4.0405, 4.0565, 4.0374,
        4.0378, 4.0302, 4.2113, 4.0386, 4.2632, 4.226 , 4.2069, 4.0335,
        4.0506, 0.    , 4.021 , 4.2084, 4.0387, 4.2084, 0.    , 4.0387,
        4.0571, 3.8645, 0.    , 0.    ],
       [3.0911, 3.3822, 0.    , 3.8954, 3.857 , 4.2899, 3.9036, 3.9032,
        4.0403, 4.0501, 4.0385, 4.6971, 0.    , 4.3101, 3.8958, 3.94  ,
        3.9547, 0.    , 0.    , 4.0338, 4.0387, 3.9202, 3.8977, 4.0006,
        3.8812, 0.    , 0.    , 3.9882, 3.9   , 3.8994, 3.9876, 4.0385,
        3.988 , 0.    , 3.9006, 0.    , 0.    , 3.9   , 0.    , 3.988 ,
        3.9879, 4.0396, 4.0385, 3.9   , 4.0388, 4.0388, 0.    , 4.0395,
        3.987 , 3.9786, 0.    , 4.0398, 3.9688, 0.    , 0.    , 0.    ,
        4.0387, 3.9001, 3.9879, 3.988 , 3.988 , 4.0387, 4.0387, 3.988 ,
        3.9   , 4.0387, 0.    , 3.9135, 4.0407, 4.0224, 4.0518, 4.0045,
        0.    , 0.    , 3.9654, 4.0985, 3.9848, 0.    , 3.9878, 0.    ,
        0.    , 0.    , 3.9   , 0.    , 3.8837, 3.8902, 3.9015, 0.    ,
        3.9732, 4.0376, 4.0007, 3.8998, 0.    , 3.9   , 4.0387, 0.    ,
        3.9879, 3.6128, 3.4   , 2.9923],
       [3.0721, 0.    , 3.6787, 3.9864, 4.1686, 4.071 , 4.0421, 3.9859,
        4.0637, 4.0825, 4.0642, 4.4535, 4.1742, 4.2395, 4.041 , 4.2597,
        4.0356, 3.9711, 3.9663, 4.0731, 4.047 , 4.008 , 4.0059, 4.0362,
        4.0387, 3.9872, 3.9872, 0.    , 3.9898, 3.9897, 0.    , 4.0573,
        0.    , 3.9877, 3.9896, 3.9885, 3.988 , 3.9899, 3.9881, 0.    ,
        0.    , 4.0572, 4.057 , 3.9898, 4.0573, 4.0559, 3.9901, 4.0565,
        0.    , 0.    , 3.9868, 4.0575, 0.    , 3.9884, 3.988 , 3.988 ,
        4.0573, 3.9899, 0.    , 0.    , 0.    , 4.0572, 4.0572, 0.    ,
        3.9899, 4.0572, 4.0077, 3.9841, 4.0537, 4.0792, 4.1879, 4.045 ,
        3.9639, 4.0359, 3.974 , 4.0577, 0.    , 3.9881, 0.    , 3.9875,
        3.9873, 3.9809, 3.9886, 3.9879, 3.9898, 3.9862, 3.9883, 3.986 ,
        0.    , 4.0678, 0.    , 3.99  , 3.988 , 3.9899, 4.057 , 3.988 ,
        0.    , 3.6657, 3.4122, 3.0508]], 

      [[3.2185, 3.3857, 4.0229, 3.9883, 4.0296, 4.2368, 4.0085, 0.    ,
        3.992 , 4.1848, 4.2114, 4.525 , 3.987 , 4.1435, 0.    , 0.    ,
        4.263 , 4.2369, 0.    , 4.1874, 0.    , 0.    , 3.995 , 0.    ,
        4.2649, 0.    , 0.    , 3.9001, 3.9899, 4.2083, 0.    , 4.2091,
        4.2084, 0.    , 3.9897, 3.9002, 0.    , 3.8999, 3.9   , 3.9   ,
        4.2083, 3.9001, 3.9897, 4.2084, 0.    , 3.9898, 4.2076, 3.989 ,
        4.2065, 3.8994, 3.989 , 0.    , 4.1964, 3.9903, 0.    , 0.    ,
        3.9899, 4.2084, 0.    , 0.    , 4.2084, 3.9899, 3.9899, 0.    ,
        3.9899, 0.    , 4.2189, 3.9108, 3.9926, 4.2112, 4.2601, 3.9546,
        4.2216, 4.2102, 0.    , 0.    , 0.    , 3.9019, 3.8985, 4.2066,
        3.9891, 3.8954, 3.9001, 3.9   , 0.    , 3.9966, 3.8997, 0.    ,
        3.8922, 3.9053, 4.223 , 3.8999, 0.    , 3.9899, 0.    , 3.9   ,
        3.9899, 3.8645, 3.3166, 2.9352],
       [0.    , 3.4708, 0.    , 4.0399, 4.0128, 4.0809, 4.0612, 4.2223,
        4.0635, 0.    , 0.    , 0.    , 4.397 , 4.33  , 4.3571, 4.143 ,
        0.    , 0.    , 4.1864, 0.    , 4.2082, 4.1835, 4.0593, 4.1206,
        0.    , 4.2075, 4.2075, 4.0388, 4.057 , 0.    , 4.2086, 0.    ,
        0.    , 4.2081, 4.0576, 4.039 , 4.2084, 4.0387, 4.0387, 4.0387,
        0.    , 4.0392, 4.0571, 0.    , 4.2084, 4.0557, 0.    , 4.0563,
        0.    , 4.0275, 4.064 , 4.2087, 0.    , 4.0567, 4.2085, 4.2083,
        4.0573, 0.    , 4.2084, 4.2084, 0.    , 4.0572, 4.0572, 4.2083,
        4.0571, 4.2083, 0.    , 4.0332, 4.0553, 0.    , 0.    , 4.0609,
        0.    , 0.    , 4.1194, 4.2827, 4.2052, 4.037 , 4.0384, 0.    ,
        4.0569, 4.0309, 4.0387, 4.0386, 4.2675, 4.049 , 4.0366, 4.1975,
        4.0174, 4.0357, 0.    , 4.0387, 4.2084, 4.0571, 4.2083, 4.0387,
        4.057 , 0.    , 3.4   , 2.9923],
       [3.0911, 0.    , 3.7942, 4.0051, 4.1481, 3.9821, 4.0888, 3.9047,
        3.985 , 4.0551, 4.0385, 4.3014, 0.    , 0.    , 3.8969, 4.1624,
        4.0727, 4.0282, 3.8954, 4.0429, 3.8953, 3.9273, 3.9969, 3.8805,
        4.0399, 3.9   , 3.9033, 0.    , 3.9881, 4.0358, 3.9006, 4.0393,
        4.0387, 3.9   , 3.9877, 0.    , 3.9001, 0.    , 0.    , 0.    ,
        4.0387, 0.    , 3.9874, 4.0386, 3.9003, 3.9879, 4.0396, 3.9875,
        4.0379, 0.    , 3.9887, 3.9001, 4.0385, 3.9882, 3.9   , 3.9   ,
        3.9879, 4.0389, 3.8999, 3.8998, 4.0387, 3.9881, 3.9881, 3.9   ,
        3.988 , 3.9   , 4.0622, 0.    , 3.9904, 4.0082, 4.0313, 3.9678,
        4.0415, 4.0964, 3.958 , 3.9005, 3.8994, 0.    , 0.    , 4.0383,
        3.9875, 0.    , 0.    , 0.    , 3.899 , 3.9924, 0.    , 3.8852,
        0.    , 0.    , 4.0695, 0.    , 3.9   , 3.988 , 3.8999, 0.    ,
        3.9879, 3.7734, 0.    , 0.    ],
       [3.0721, 3.3333, 3.7376, 0.    , 0.    , 0.    , 0.    , 4.002 ,
        0.    , 4.0925, 4.0635, 4.694 , 4.1711, 4.5107, 4.101 , 3.9965,
        4.1134, 4.0603, 3.979 , 4.0877, 4.0184, 4.0056, 0.    , 3.9926,
        4.0418, 3.9905, 3.993 , 3.9863, 0.    , 4.0566, 3.9893, 4.0574,
        4.057 , 3.9896, 0.    , 3.9885, 3.9899, 3.9879, 3.9881, 3.9879,
        4.057 , 3.9889, 0.    , 4.0571, 3.9896, 0.    , 4.0573, 0.    ,
        4.0578, 3.9888, 0.    , 3.9903, 4.0585, 0.    , 3.9899, 3.9898,
        0.    , 4.0572, 3.9898, 3.9899, 4.0571, 0.    , 0.    , 3.9899,
        0.    , 3.9898, 4.0628, 3.9963, 0.    , 4.0693, 4.2053, 0.    ,
        4.0816, 4.0695, 3.9643, 3.9945, 3.9874, 3.9876, 3.9877, 4.057 ,
        0.    , 3.9827, 3.9935, 3.9879, 3.9893, 0.    , 3.9876, 3.9953,
        4.0026, 3.9879, 4.0276, 3.988 , 3.9899, 0.    , 3.9899, 3.988 ,
        0.    , 3.7677, 3.3241, 2.9875]]])


	model = OneLayer(4, seq_len)
	precomputation = precompute(model, seq_len=seq_len, n_choices=4, alpha=1)
	isms = yuzu_ism(model, X, precomputation)
	assert_array_almost_equal(isms, one_layer_ism_scores, 3)

def test_small_probes_toynet():
	toynet_ism_scores = numpy.array([
	  [[0.0399, 0.0635, 0.0593, 0.    , 0.    , 0.0773, 0.    , 0.    ,
        0.0833, 0.0734, 0.0735, 0.    , 0.0749, 0.0747, 0.    , 0.0879,
        0.    , 0.0827, 0.0654, 0.0942, 0.0862, 0.    , 0.    , 0.0812,
        0.    , 0.0756, 0.0899, 0.0749, 0.    , 0.    , 0.076 , 0.0803,
        0.0663, 0.0606, 0.    , 0.0703, 0.0656, 0.    , 0.0944, 0.079 ,
        0.0894, 0.0727, 0.0858, 0.    , 0.069 , 0.0856, 0.0882, 0.1019,
        0.0766, 0.1016, 0.1033, 0.0696, 0.0743, 0.0781, 0.0665, 0.0624,
        0.095 , 0.    , 0.0984, 0.0857, 0.0853, 0.1637, 0.0591, 0.0731,
        0.    , 0.0708, 0.0751, 0.    , 0.0747, 0.0933, 0.0876, 0.0828,
        0.1433, 0.0581, 0.    , 0.0925, 0.0688, 0.0715, 0.0931, 0.0695,
        0.074 , 0.0765, 0.    , 0.0702, 0.    , 0.    , 0.    , 0.0689,
        0.071 , 0.0775, 0.0746, 0.    , 0.0629, 0.    , 0.0501, 0.0821,
        0.0655, 0.    , 0.0336, 0.0457],
       [0.    , 0.0566, 0.0688, 0.0728, 0.0633, 0.    , 0.1021, 0.0692,
        0.    , 0.    , 0.    , 0.0823, 0.0904, 0.    , 0.0624, 0.    ,
        0.0667, 0.0732, 0.0843, 0.    , 0.    , 0.0911, 0.0811, 0.    ,
        0.0751, 0.0872, 0.0838, 0.1001, 0.0761, 0.0714, 0.0863, 0.    ,
        0.0936, 0.0868, 0.0621, 0.0925, 0.0689, 0.092 , 0.0822, 0.1062,
        0.0861, 0.    , 0.    , 0.0945, 0.    , 0.    , 0.1193, 0.    ,
        0.1042, 0.0993, 0.0887, 0.    , 0.1034, 0.0803, 0.0805, 0.0853,
        0.    , 0.0877, 0.1028, 0.0912, 0.104 , 0.    , 0.    , 0.1078,
        0.074 , 0.    , 0.0958, 0.0912, 0.    , 0.    , 0.    , 0.    ,
        0.0725, 0.0777, 0.0919, 0.    , 0.0935, 0.0859, 0.101 , 0.0609,
        0.0668, 0.0825, 0.0647, 0.079 , 0.0706, 0.077 , 0.0815, 0.0945,
        0.0949, 0.    , 0.1142, 0.0729, 0.071 , 0.0758, 0.    , 0.0713,
        0.0665, 0.0598, 0.    , 0.    ],
       [0.0536, 0.055 , 0.    , 0.0677, 0.0685, 0.0707, 0.0821, 0.0775,
        0.0904, 0.0741, 0.088 , 0.0812, 0.    , 0.0752, 0.0667, 0.0933,
        0.081 , 0.    , 0.    , 0.0891, 0.1006, 0.0858, 0.0684, 0.0897,
        0.0752, 0.    , 0.    , 0.0886, 0.0824, 0.0773, 0.0913, 0.0707,
        0.102 , 0.    , 0.065 , 0.    , 0.    , 0.0788, 0.    , 0.075 ,
        0.1264, 0.1147, 0.0985, 0.1055, 0.0902, 0.066 , 0.    , 0.1221,
        0.0777, 0.1078, 0.    , 0.0835, 0.0866, 0.    , 0.    , 0.    ,
        0.0963, 0.093 , 0.1003, 0.0926, 0.0969, 0.0882, 0.1127, 0.1238,
        0.0862, 0.0688, 0.    , 0.0886, 0.0891, 0.1406, 0.099 , 0.109 ,
        0.    , 0.    , 0.0796, 0.0735, 0.0656, 0.    , 0.1008, 0.    ,
        0.    , 0.    , 0.0866, 0.    , 0.0767, 0.0859, 0.071 , 0.    ,
        0.0918, 0.0749, 0.0999, 0.0851, 0.    , 0.0654, 0.072 , 0.    ,
        0.0719, 0.0538, 0.0517, 0.0462],
       [0.0528, 0.    , 0.0735, 0.0792, 0.0847, 0.0857, 0.0909, 0.0623,
        0.0989, 0.0923, 0.0909, 0.0795, 0.1056, 0.1028, 0.0514, 0.1108,
        0.0781, 0.0949, 0.0738, 0.096 , 0.1097, 0.1015, 0.095 , 0.1051,
        0.0826, 0.0991, 0.081 , 0.    , 0.0869, 0.0736, 0.    , 0.0867,
        0.    , 0.1169, 0.093 , 0.0923, 0.0745, 0.0786, 0.0931, 0.    ,
        0.    , 0.1346, 0.0917, 0.0808, 0.1148, 0.093 , 0.1381, 0.1042,
        0.    , 0.    , 0.1097, 0.0813, 0.    , 0.099 , 0.0851, 0.1029,
        0.0868, 0.1097, 0.    , 0.    , 0.    , 0.1082, 0.1068, 0.    ,
        0.1146, 0.0811, 0.0761, 0.1385, 0.1294, 0.0923, 0.0948, 0.097 ,
        0.0965, 0.0968, 0.083 , 0.0911, 0.    , 0.1114, 0.    , 0.0963,
        0.0958, 0.0802, 0.0724, 0.0962, 0.0777, 0.0744, 0.0688, 0.0834,
        0.    , 0.079 , 0.    , 0.0898, 0.0781, 0.0846, 0.0695, 0.0738,
        0.    , 0.0725, 0.0708, 0.056 ]],

      [[0.0465, 0.0542, 0.0729, 0.0805, 0.0934, 0.084 , 0.0842, 0.    ,
        0.0736, 0.0901, 0.0958, 0.0743, 0.0842, 0.0748, 0.    , 0.    ,
        0.0842, 0.0902, 0.    , 0.0682, 0.    , 0.    , 0.0787, 0.    ,
        0.0944, 0.    , 0.    , 0.0838, 0.082 , 0.0902, 0.    , 0.0835,
        0.0731, 0.    , 0.0669, 0.0722, 0.    , 0.0659, 0.0695, 0.0996,
        0.1539, 0.1506, 0.0864, 0.0964, 0.    , 0.0897, 0.1037, 0.1017,
        0.0938, 0.0974, 0.0881, 0.    , 0.0766, 0.0802, 0.    , 0.    ,
        0.1097, 0.1141, 0.    , 0.    , 0.0777, 0.0804, 0.0948, 0.    ,
        0.1136, 0.    , 0.0669, 0.077 , 0.0942, 0.1361, 0.1286, 0.1209,
        0.0811, 0.0803, 0.    , 0.    , 0.    , 0.0699, 0.0838, 0.079 ,
        0.0695, 0.0814, 0.0702, 0.0803, 0.    , 0.0817, 0.0721, 0.    ,
        0.0726, 0.0805, 0.0892, 0.0689, 0.    , 0.0745, 0.    , 0.0568,
        0.0694, 0.0613, 0.0605, 0.0523],
       [0.    , 0.0658, 0.    , 0.07  , 0.0858, 0.0874, 0.0856, 0.0877,
        0.0965, 0.    , 0.    , 0.    , 0.0794, 0.0836, 0.0802, 0.0784,
        0.    , 0.    , 0.0645, 0.    , 0.0718, 0.0703, 0.0847, 0.093 ,
        0.    , 0.0829, 0.0898, 0.0875, 0.1083, 0.    , 0.0905, 0.    ,
        0.    , 0.0789, 0.0847, 0.081 , 0.0638, 0.0917, 0.0864, 0.0907,
        0.    , 0.0952, 0.0821, 0.    , 0.0998, 0.0927, 0.    , 0.1031,
        0.    , 0.0841, 0.1082, 0.082 , 0.    , 0.0903, 0.0766, 0.0711,
        0.0847, 0.    , 0.09  , 0.0847, 0.    , 0.0899, 0.0998, 0.0855,
        0.0775, 0.071 , 0.    , 0.2157, 0.1415, 0.    , 0.    , 0.108 ,
        0.    , 0.    , 0.067 , 0.0851, 0.0747, 0.0785, 0.0703, 0.    ,
        0.119 , 0.0903, 0.0576, 0.0805, 0.084 , 0.0726, 0.0804, 0.0709,
        0.0771, 0.0917, 0.    , 0.0829, 0.0791, 0.0658, 0.0838, 0.0742,
        0.0881, 0.    , 0.0558, 0.0404],
       [0.0416, 0.    , 0.0743, 0.0695, 0.0808, 0.0668, 0.0914, 0.0837,
        0.0757, 0.1015, 0.0819, 0.1096, 0.    , 0.    , 0.086 , 0.0846,
        0.0923, 0.1025, 0.076 , 0.0812, 0.0685, 0.0715, 0.0983, 0.0658,
        0.0861, 0.081 , 0.0811, 0.    , 0.0794, 0.0891, 0.0863, 0.0923,
        0.0927, 0.0688, 0.0919, 0.    , 0.0701, 0.    , 0.    , 0.    ,
        0.0938, 0.    , 0.0951, 0.0893, 0.0754, 0.1134, 0.1089, 0.0958,
        0.0907, 0.    , 0.0932, 0.0633, 0.0872, 0.0923, 0.0704, 0.0699,
        0.0949, 0.0991, 0.1453, 0.0896, 0.113 , 0.1327, 0.1069, 0.0833,
        0.1284, 0.082 , 0.22  , 0.    , 0.0779, 0.1747, 0.0881, 0.1365,
        0.0779, 0.1657, 0.0644, 0.0651, 0.0645, 0.    , 0.    , 0.0821,
        0.1093, 0.    , 0.    , 0.    , 0.0717, 0.0918, 0.    , 0.0806,
        0.    , 0.    , 0.0788, 0.    , 0.0832, 0.0895, 0.0657, 0.    ,
        0.0845, 0.0746, 0.    , 0.    ],
       [0.0752, 0.0602, 0.06  , 0.    , 0.    , 0.    , 0.    , 0.0944,
        0.    , 0.1069, 0.0814, 0.0962, 0.1007, 0.0844, 0.0746, 0.0728,
        0.1139, 0.1066, 0.0773, 0.0981, 0.0859, 0.0884, 0.    , 0.0827,
        0.1021, 0.0876, 0.0851, 0.0828, 0.    , 0.1052, 0.0555, 0.0963,
        0.0925, 0.0697, 0.    , 0.0851, 0.1036, 0.0752, 0.0955, 0.1038,
        0.0975, 0.1361, 0.    , 0.1169, 0.0745, 0.    , 0.0836, 0.    ,
        0.1016, 0.0831, 0.    , 0.0905, 0.0649, 0.    , 0.1036, 0.0765,
        0.    , 0.135 , 0.0873, 0.0799, 0.1373, 0.    , 0.    , 0.112 ,
        0.    , 0.0938, 0.0843, 0.0647, 0.    , 0.1576, 0.1378, 0.    ,
        0.1591, 0.085 , 0.0782, 0.0733, 0.0667, 0.064 , 0.0841, 0.1024,
        0.    , 0.1261, 0.0879, 0.1005, 0.093 , 0.    , 0.0907, 0.0878,
        0.0919, 0.0931, 0.0987, 0.0823, 0.0868, 0.    , 0.0988, 0.0853,
        0.    , 0.0671, 0.0677, 0.059 ]]])


	model = ToyNet(4, seq_len)
	precomputation = precompute(model, seq_len=seq_len, n_choices=4, alpha=1)
	isms = yuzu_ism(model, X, precomputation)
	assert_array_almost_equal(isms, toynet_ism_scores, 3)

def test_small_probes_deepsea():
	deepsea_ism_scores = numpy.array([
	  [[0.0104, 0.0128, 0.0128, 0.    , 0.    , 0.0159, 0.    , 0.    ,
        0.0173, 0.0178, 0.0181, 0.    , 0.0186, 0.0199, 0.    , 0.0214,
        0.    , 0.0197, 0.0203, 0.0217, 0.0218, 0.    , 0.    , 0.0231,
        0.    , 0.0208, 0.0226, 0.0229, 0.    , 0.    , 0.0243, 0.0216,
        0.023 , 0.0225, 0.    , 0.0216, 0.022 , 0.    , 0.0208, 0.0224,
        0.0236, 0.0212, 0.023 , 0.    , 0.0219, 0.0227, 0.0214, 0.0218,
        0.0214, 0.0227, 0.0246, 0.0271, 0.0243, 0.024 , 0.0249, 0.023 ,
        0.022 , 0.    , 0.0236, 0.0204, 0.0261, 0.0235, 0.0247, 0.023 ,
        0.    , 0.0254, 0.0222, 0.    , 0.0225, 0.0252, 0.0331, 0.0219,
        0.0237, 0.0215, 0.    , 0.0226, 0.022 , 0.0208, 0.0224, 0.0236,
        0.02  , 0.0203, 0.    , 0.0184, 0.    , 0.    , 0.    , 0.0183,
        0.0172, 0.0159, 0.0207, 0.    , 0.0164, 0.    , 0.0158, 0.0165,
        0.0148, 0.    , 0.0128, 0.0107],
       [0.    , 0.0131, 0.0131, 0.0135, 0.0165, 0.    , 0.0162, 0.0172,
        0.    , 0.    , 0.    , 0.0185, 0.0198, 0.    , 0.021 , 0.    ,
        0.0213, 0.0209, 0.0227, 0.    , 0.    , 0.023 , 0.0217, 0.    ,
        0.0223, 0.0223, 0.0217, 0.0239, 0.0222, 0.0208, 0.0235, 0.    ,
        0.0234, 0.0236, 0.0215, 0.0219, 0.0225, 0.022 , 0.0221, 0.0226,
        0.0246, 0.    , 0.    , 0.0225, 0.    , 0.    , 0.0232, 0.    ,
        0.0206, 0.0237, 0.0226, 0.    , 0.0243, 0.0231, 0.0228, 0.0248,
        0.    , 0.023 , 0.0226, 0.0207, 0.023 , 0.    , 0.    , 0.0218,
        0.0206, 0.    , 0.0229, 0.0237, 0.    , 0.    , 0.    , 0.    ,
        0.0231, 0.0225, 0.0243, 0.    , 0.0221, 0.0209, 0.0209, 0.0196,
        0.0182, 0.023 , 0.0194, 0.0199, 0.0189, 0.0204, 0.0183, 0.0179,
        0.02  , 0.    , 0.0183, 0.021 , 0.0158, 0.0166, 0.    , 0.0156,
        0.0146, 0.0135, 0.    , 0.    ],
       [0.0116, 0.0127, 0.    , 0.015 , 0.0155, 0.0161, 0.0175, 0.0175,
        0.0202, 0.0177, 0.0189, 0.0175, 0.    , 0.0197, 0.02  , 0.0206,
        0.0206, 0.    , 0.    , 0.0229, 0.0214, 0.0223, 0.0229, 0.0224,
        0.0223, 0.    , 0.    , 0.0216, 0.0228, 0.0215, 0.0233, 0.0221,
        0.0234, 0.    , 0.0241, 0.    , 0.    , 0.0231, 0.    , 0.0222,
        0.0224, 0.0223, 0.0224, 0.0238, 0.0208, 0.0224, 0.    , 0.0227,
        0.022 , 0.0253, 0.    , 0.0233, 0.0221, 0.    , 0.    , 0.    ,
        0.0222, 0.0229, 0.0234, 0.0224, 0.0222, 0.0234, 0.023 , 0.0232,
        0.0208, 0.0229, 0.    , 0.0226, 0.0226, 0.0215, 0.0222, 0.0225,
        0.    , 0.    , 0.021 , 0.0226, 0.0224, 0.    , 0.0219, 0.    ,
        0.    , 0.    , 0.0215, 0.    , 0.0191, 0.0178, 0.019 , 0.    ,
        0.0189, 0.0183, 0.0187, 0.0172, 0.    , 0.0156, 0.0145, 0.    ,
        0.013 , 0.013 , 0.0124, 0.0107],
       [0.0113, 0.    , 0.0133, 0.0141, 0.0175, 0.0174, 0.018 , 0.0163,
        0.0184, 0.019 , 0.0192, 0.0192, 0.0201, 0.0194, 0.0213, 0.02  ,
        0.0207, 0.0212, 0.0202, 0.022 , 0.0206, 0.0227, 0.0249, 0.0223,
        0.0231, 0.0244, 0.0207, 0.    , 0.0211, 0.0202, 0.    , 0.0222,
        0.    , 0.0216, 0.0219, 0.0228, 0.0213, 0.0218, 0.0222, 0.    ,
        0.    , 0.021 , 0.0219, 0.0226, 0.0211, 0.0237, 0.0208, 0.0223,
        0.    , 0.    , 0.0235, 0.023 , 0.    , 0.0237, 0.0223, 0.0214,
        0.0201, 0.0229, 0.    , 0.    , 0.    , 0.0236, 0.0231, 0.    ,
        0.0216, 0.0241, 0.0241, 0.0198, 0.0235, 0.0214, 0.0206, 0.0213,
        0.0217, 0.0224, 0.0205, 0.022 , 0.    , 0.0213, 0.    , 0.0224,
        0.0202, 0.0194, 0.018 , 0.0181, 0.0185, 0.02  , 0.0178, 0.0179,
        0.    , 0.0167, 0.    , 0.0167, 0.0147, 0.0162, 0.0168, 0.0145,
        0.    , 0.0124, 0.0119, 0.0108]], 

      [[0.0134, 0.0125, 0.0138, 0.0157, 0.016 , 0.0171, 0.0169, 0.    ,
        0.0161, 0.0182, 0.0181, 0.0185, 0.0196, 0.0194, 0.    , 0.    ,
        0.0196, 0.0206, 0.    , 0.0225, 0.    , 0.    , 0.0214, 0.    ,
        0.023 , 0.    , 0.    , 0.0207, 0.0232, 0.0226, 0.    , 0.022 ,
        0.0231, 0.    , 0.0228, 0.0221, 0.    , 0.019 , 0.0228, 0.0229,
        0.0211, 0.0233, 0.0235, 0.0212, 0.    , 0.0245, 0.0232, 0.0221,
        0.0235, 0.0241, 0.0244, 0.    , 0.0219, 0.0245, 0.    , 0.    ,
        0.0245, 0.0259, 0.    , 0.    , 0.0227, 0.022 , 0.0236, 0.    ,
        0.0219, 0.    , 0.0239, 0.0239, 0.0234, 0.023 , 0.0322, 0.0244,
        0.0224, 0.0224, 0.    , 0.    , 0.    , 0.0217, 0.0206, 0.0204,
        0.0204, 0.0206, 0.0226, 0.021 , 0.    , 0.0222, 0.021 , 0.    ,
        0.0206, 0.0166, 0.019 , 0.0162, 0.    , 0.0155, 0.    , 0.0148,
        0.0131, 0.0121, 0.0117, 0.0123],
       [0.    , 0.0116, 0.    , 0.015 , 0.0176, 0.017 , 0.0184, 0.018 ,
        0.0181, 0.    , 0.    , 0.    , 0.0195, 0.0211, 0.0184, 0.0199,
        0.    , 0.    , 0.0206, 0.    , 0.0221, 0.022 , 0.022 , 0.0228,
        0.    , 0.0226, 0.0224, 0.0231, 0.0223, 0.    , 0.0245, 0.    ,
        0.    , 0.0225, 0.0249, 0.0223, 0.0244, 0.0232, 0.0233, 0.0227,
        0.    , 0.0249, 0.0213, 0.    , 0.0213, 0.0216, 0.    , 0.0223,
        0.    , 0.0257, 0.0233, 0.0223, 0.    , 0.024 , 0.0241, 0.0229,
        0.0238, 0.    , 0.0257, 0.0217, 0.    , 0.0223, 0.0237, 0.0226,
        0.023 , 0.022 , 0.    , 0.0222, 0.0224, 0.    , 0.    , 0.0223,
        0.    , 0.    , 0.0241, 0.0227, 0.0222, 0.0224, 0.0224, 0.    ,
        0.0186, 0.0242, 0.0189, 0.0205, 0.0193, 0.0192, 0.0177, 0.0178,
        0.018 , 0.0165, 0.    , 0.0173, 0.0163, 0.0167, 0.016 , 0.0154,
        0.0135, 0.    , 0.0115, 0.0107],
       [0.0126, 0.    , 0.0134, 0.0162, 0.0178, 0.0178, 0.0176, 0.0171,
        0.0166, 0.0171, 0.0169, 0.0174, 0.    , 0.    , 0.0207, 0.0197,
        0.0207, 0.0217, 0.0217, 0.0231, 0.0232, 0.0236, 0.0273, 0.0209,
        0.0222, 0.023 , 0.0222, 0.    , 0.0214, 0.0263, 0.0243, 0.0225,
        0.0218, 0.0242, 0.0229, 0.    , 0.0224, 0.    , 0.    , 0.    ,
        0.0211, 0.    , 0.0216, 0.0223, 0.0226, 0.0214, 0.0227, 0.0217,
        0.0213, 0.    , 0.0204, 0.0236, 0.0233, 0.0228, 0.0242, 0.0234,
        0.0232, 0.0248, 0.0239, 0.0214, 0.0243, 0.0233, 0.023 , 0.0228,
        0.0223, 0.0246, 0.0254, 0.    , 0.0239, 0.0233, 0.0247, 0.0224,
        0.0214, 0.0235, 0.0221, 0.0212, 0.0216, 0.    , 0.    , 0.0237,
        0.0184, 0.    , 0.    , 0.    , 0.0211, 0.0198, 0.    , 0.0196,
        0.    , 0.    , 0.0209, 0.    , 0.0161, 0.0162, 0.0153, 0.    ,
        0.0125, 0.013 , 0.    , 0.    ],
       [0.0115, 0.0127, 0.0131, 0.    , 0.    , 0.    , 0.    , 0.0172,
        0.    , 0.0173, 0.0177, 0.0191, 0.0199, 0.019 , 0.0194, 0.0192,
        0.0206, 0.021 , 0.0221, 0.0229, 0.02  , 0.0213, 0.    , 0.0197,
        0.0234, 0.0224, 0.0215, 0.0215, 0.    , 0.0236, 0.0221, 0.025 ,
        0.0229, 0.0216, 0.    , 0.0216, 0.0245, 0.0244, 0.0237, 0.021 ,
        0.0216, 0.0236, 0.    , 0.0207, 0.0232, 0.    , 0.0242, 0.    ,
        0.0242, 0.0233, 0.    , 0.0245, 0.0238, 0.    , 0.0219, 0.0227,
        0.    , 0.0242, 0.022 , 0.0232, 0.021 , 0.    , 0.    , 0.0214,
        0.    , 0.0244, 0.0232, 0.0238, 0.    , 0.0214, 0.0208, 0.    ,
        0.0235, 0.023 , 0.0203, 0.0234, 0.0207, 0.0215, 0.0233, 0.0259,
        0.    , 0.0193, 0.0204, 0.0182, 0.02  , 0.    , 0.0199, 0.0178,
        0.0181, 0.0178, 0.02  , 0.021 , 0.0163, 0.    , 0.016 , 0.0145,
        0.    , 0.0128, 0.0128, 0.011 ]]])


	model = DeepSEA(4, seq_len)
	precomputation = precompute(model, seq_len=seq_len, n_choices=4, alpha=1)
	isms = yuzu_ism(model, X, precomputation)
	assert_array_almost_equal(isms, deepsea_ism_scores, 3)

def test_small_probes_basset():
	basset_ism_scores = numpy.array([
	  [[0.0253, 0.0167, 0.004 , 0.    , 0.    , 0.0219, 0.    , 0.    ,
        0.0154, 0.0226, 0.0099, 0.    , 0.0074, 0.0278, 0.    , 0.0115,
        0.    , 0.0472, 0.008 , 0.0083, 0.0094, 0.    , 0.    , 0.0125,
        0.    , 0.018 , 0.0365, 0.0208, 0.    , 0.    , 0.0352, 0.0192,
        0.01  , 0.0212, 0.    , 0.0286, 0.0162, 0.    , 0.0202, 0.0194,
        0.0243, 0.0449, 0.0162, 0.    , 0.0321, 0.0224, 0.0141, 0.0175,
        0.0148, 0.0144, 0.0093, 0.0342, 0.0109, 0.0322, 0.0118, 0.0341,
        0.0356, 0.    , 0.015 , 0.022 , 0.0203, 0.0223, 0.0203, 0.0254,
        0.    , 0.0097, 0.0255, 0.    , 0.0293, 0.0143, 0.0322, 0.0209,
        0.0181, 0.034 , 0.    , 0.0124, 0.0168, 0.0187, 0.015 , 0.0202,
        0.0441, 0.0101, 0.    , 0.0306, 0.    , 0.    , 0.    , 0.013 ,
        0.0084, 0.016 , 0.0133, 0.    , 0.0136, 0.    , 0.023 , 0.0202,
        0.013 , 0.    , 0.0288, 0.0443],
       [0.    , 0.009 , 0.0078, 0.0148, 0.0333, 0.    , 0.0198, 0.0068,
        0.    , 0.    , 0.    , 0.0214, 0.0219, 0.    , 0.0185, 0.    ,
        0.0315, 0.0107, 0.0373, 0.    , 0.    , 0.0323, 0.0456, 0.    ,
        0.0333, 0.0288, 0.0416, 0.0296, 0.0172, 0.0259, 0.0258, 0.    ,
        0.0211, 0.0368, 0.039 , 0.0154, 0.0244, 0.0267, 0.0231, 0.0182,
        0.0185, 0.    , 0.    , 0.0207, 0.    , 0.    , 0.011 , 0.    ,
        0.0201, 0.0198, 0.0512, 0.    , 0.034 , 0.0178, 0.015 , 0.0154,
        0.    , 0.0133, 0.0282, 0.0206, 0.0545, 0.    , 0.    , 0.0295,
        0.0249, 0.    , 0.02  , 0.0166, 0.    , 0.    , 0.    , 0.    ,
        0.0436, 0.0226, 0.0139, 0.    , 0.0089, 0.0183, 0.0146, 0.0193,
        0.0157, 0.0078, 0.0125, 0.0175, 0.0206, 0.0408, 0.0092, 0.0627,
        0.0209, 0.    , 0.006 , 0.0261, 0.0166, 0.0077, 0.    , 0.007 ,
        0.0412, 0.0321, 0.    , 0.    ],
       [0.0443, 0.0072, 0.    , 0.0239, 0.0162, 0.0079, 0.0211, 0.0059,
        0.0194, 0.0076, 0.0102, 0.0142, 0.    , 0.0118, 0.0089, 0.009 ,
        0.0167, 0.    , 0.    , 0.0129, 0.0248, 0.0139, 0.0563, 0.0116,
        0.0225, 0.    , 0.    , 0.0194, 0.0132, 0.0515, 0.0161, 0.023 ,
        0.0285, 0.    , 0.0189, 0.    , 0.    , 0.0112, 0.    , 0.0124,
        0.036 , 0.0453, 0.0437, 0.0215, 0.037 , 0.0246, 0.    , 0.0112,
        0.0115, 0.0483, 0.    , 0.0103, 0.0129, 0.    , 0.    , 0.    ,
        0.0491, 0.0192, 0.0315, 0.0096, 0.0235, 0.0281, 0.0173, 0.0201,
        0.0338, 0.0341, 0.    , 0.0276, 0.0191, 0.0212, 0.0188, 0.0211,
        0.    , 0.    , 0.0153, 0.025 , 0.0139, 0.    , 0.0175, 0.    ,
        0.    , 0.    , 0.0307, 0.    , 0.0088, 0.0138, 0.013 , 0.    ,
        0.0377, 0.0107, 0.0167, 0.0213, 0.    , 0.0308, 0.071 , 0.    ,
        0.0228, 0.0066, 0.0098, 0.0082],
       [0.0188, 0.    , 0.0212, 0.0173, 0.012 , 0.0446, 0.0058, 0.0168,
        0.0251, 0.007 , 0.012 , 0.0146, 0.0094, 0.0342, 0.011 , 0.0171,
        0.031 , 0.0233, 0.0257, 0.0278, 0.0208, 0.0139, 0.0093, 0.0152,
        0.0751, 0.0151, 0.0223, 0.    , 0.0099, 0.0179, 0.    , 0.0253,
        0.    , 0.0458, 0.0142, 0.0277, 0.0287, 0.0157, 0.0482, 0.    ,
        0.    , 0.0267, 0.0257, 0.0247, 0.0485, 0.0174, 0.0281, 0.0181,
        0.    , 0.    , 0.0193, 0.0144, 0.    , 0.03  , 0.0169, 0.0369,
        0.0249, 0.0289, 0.    , 0.    , 0.    , 0.0153, 0.0277, 0.    ,
        0.0349, 0.0208, 0.0783, 0.0295, 0.0221, 0.0372, 0.0317, 0.0136,
        0.0256, 0.0085, 0.0336, 0.0338, 0.    , 0.0085, 0.    , 0.0082,
        0.0348, 0.0144, 0.0094, 0.032 , 0.0239, 0.0183, 0.0064, 0.0435,
        0.    , 0.0137, 0.    , 0.0093, 0.0371, 0.0338, 0.0244, 0.0168,
        0.    , 0.0346, 0.0143, 0.0498]], 

      [[0.0349, 0.0119, 0.0086, 0.0159, 0.0329, 0.009 , 0.0253, 0.    ,
        0.017 , 0.0266, 0.0109, 0.0164, 0.0068, 0.0301, 0.    , 0.    ,
        0.0321, 0.0098, 0.    , 0.0082, 0.    , 0.    , 0.0565, 0.    ,
        0.0878, 0.    , 0.    , 0.0265, 0.0175, 0.0185, 0.    , 0.0252,
        0.0292, 0.    , 0.0416, 0.0302, 0.    , 0.0105, 0.0207, 0.0204,
        0.0359, 0.0333, 0.0474, 0.0261, 0.    , 0.0266, 0.0085, 0.0131,
        0.011 , 0.0174, 0.018 , 0.    , 0.0129, 0.026 , 0.    , 0.    ,
        0.0591, 0.0256, 0.    , 0.    , 0.0266, 0.0362, 0.0189, 0.    ,
        0.0206, 0.    , 0.0227, 0.0351, 0.0197, 0.0168, 0.0294, 0.0247,
        0.0333, 0.0228, 0.    , 0.    , 0.    , 0.0231, 0.0184, 0.0204,
        0.0278, 0.0082, 0.0254, 0.0286, 0.    , 0.0461, 0.0118, 0.    ,
        0.0228, 0.0187, 0.017 , 0.0213, 0.    , 0.0084, 0.    , 0.0222,
        0.0154, 0.0479, 0.0158, 0.0493],
       [0.    , 0.0055, 0.    , 0.027 , 0.0153, 0.055 , 0.0267, 0.0064,
        0.0257, 0.    , 0.    , 0.    , 0.0235, 0.0359, 0.0182, 0.0079,
        0.    , 0.    , 0.0234, 0.    , 0.0291, 0.0356, 0.063 , 0.0144,
        0.    , 0.0156, 0.0158, 0.0175, 0.0124, 0.    , 0.0269, 0.    ,
        0.    , 0.0602, 0.0216, 0.0176, 0.0213, 0.0178, 0.0184, 0.0155,
        0.    , 0.0522, 0.0195, 0.    , 0.0367, 0.0219, 0.    , 0.0201,
        0.    , 0.0482, 0.0101, 0.0097, 0.    , 0.0357, 0.0168, 0.0347,
        0.0227, 0.    , 0.0144, 0.0244, 0.    , 0.0152, 0.0294, 0.0259,
        0.0294, 0.0342, 0.    , 0.024 , 0.018 , 0.    , 0.    , 0.0108,
        0.    , 0.    , 0.0123, 0.0266, 0.0191, 0.0187, 0.0195, 0.    ,
        0.0492, 0.0084, 0.0079, 0.0162, 0.0179, 0.0177, 0.0068, 0.047 ,
        0.0486, 0.0165, 0.    , 0.0106, 0.0375, 0.0341, 0.0727, 0.0081,
        0.0404, 0.    , 0.0365, 0.0472],
       [0.0483, 0.    , 0.027 , 0.021 , 0.0113, 0.0229, 0.007 , 0.006 ,
        0.0183, 0.0075, 0.012 , 0.024 , 0.    , 0.    , 0.0082, 0.0204,
        0.0286, 0.0176, 0.0082, 0.0105, 0.0225, 0.0174, 0.0092, 0.0145,
        0.0382, 0.0209, 0.0346, 0.    , 0.0122, 0.0232, 0.0285, 0.0232,
        0.0085, 0.018 , 0.0147, 0.    , 0.0159, 0.    , 0.    , 0.    ,
        0.0241, 0.    , 0.0211, 0.0153, 0.0452, 0.0233, 0.0325, 0.0156,
        0.0192, 0.    , 0.0499, 0.0166, 0.0091, 0.0178, 0.0106, 0.0294,
        0.0331, 0.0117, 0.0278, 0.0172, 0.0248, 0.0178, 0.0175, 0.0237,
        0.024 , 0.0211, 0.0553, 0.    , 0.036 , 0.0213, 0.0186, 0.0147,
        0.0324, 0.0081, 0.0135, 0.0346, 0.0125, 0.    , 0.    , 0.01  ,
        0.0227, 0.    , 0.    , 0.    , 0.0084, 0.0191, 0.    , 0.0159,
        0.    , 0.    , 0.014 , 0.    , 0.0117, 0.042 , 0.0284, 0.    ,
        0.0231, 0.0329, 0.    , 0.    ],
       [0.0236, 0.0184, 0.0048, 0.    , 0.    , 0.    , 0.    , 0.0148,
        0.    , 0.006 , 0.0124, 0.0121, 0.0086, 0.012 , 0.0133, 0.0128,
        0.0221, 0.0523, 0.0444, 0.0247, 0.0102, 0.0127, 0.    , 0.013 ,
        0.028 , 0.0385, 0.0364, 0.0208, 0.    , 0.0438, 0.0158, 0.0248,
        0.0266, 0.0423, 0.    , 0.0339, 0.0244, 0.0388, 0.053 , 0.0205,
        0.016 , 0.0389, 0.    , 0.019 , 0.0381, 0.    , 0.0107, 0.    ,
        0.0197, 0.0223, 0.    , 0.0356, 0.0417, 0.    , 0.0167, 0.0156,
        0.    , 0.018 , 0.0365, 0.0099, 0.0403, 0.    , 0.    , 0.0271,
        0.    , 0.0072, 0.0244, 0.0149, 0.    , 0.0515, 0.0211, 0.    ,
        0.0166, 0.0404, 0.0355, 0.0118, 0.015 , 0.0081, 0.0163, 0.0195,
        0.    , 0.0159, 0.0107, 0.0345, 0.0277, 0.    , 0.0088, 0.0608,
        0.0075, 0.0122, 0.0057, 0.0309, 0.0131, 0.    , 0.024 , 0.0214,
        0.    , 0.0068, 0.0106, 0.0085]]])


	model = Basset(4, seq_len)
	precomputation = precompute(model, seq_len=seq_len, n_choices=4, alpha=1)
	isms = yuzu_ism(model, X, precomputation)
	assert_array_almost_equal(isms, basset_ism_scores, 3)

def test_small_probes_factorized_basset():
	factorized_basset_ism_scores = numpy.array([
      [[1.06e-06, 6.00e-08, 3.00e-07, 0.00e+00, 0.00e+00, 1.53e-06,
        0.00e+00, 0.00e+00, 4.50e-07, 1.45e-06, 1.08e-06, 0.00e+00,
        6.90e-07, 7.40e-07, 0.00e+00, 1.20e-07, 0.00e+00, 2.56e-06,
        1.22e-06, 7.20e-07, 3.00e-08, 0.00e+00, 0.00e+00, 1.91e-06,
        0.00e+00, 6.40e-07, 2.18e-06, 3.68e-06, 0.00e+00, 0.00e+00,
        1.28e-06, 1.03e-06, 1.30e-06, 1.77e-06, 0.00e+00, 3.60e-07,
        3.60e-07, 0.00e+00, 8.70e-07, 1.07e-06, 1.94e-06, 2.47e-06,
        3.24e-06, 0.00e+00, 6.00e-08, 1.82e-06, 1.38e-06, 2.44e-06,
        7.20e-07, 2.70e-06, 2.26e-06, 1.90e-07, 1.80e-07, 9.90e-07,
        1.25e-06, 1.32e-06, 1.39e-06, 0.00e+00, 2.00e-07, 1.79e-06,
        1.90e-06, 1.65e-06, 1.58e-06, 2.50e-07, 0.00e+00, 8.20e-07,
        1.80e-06, 0.00e+00, 1.20e-06, 1.86e-06, 2.33e-06, 9.20e-07,
        3.37e-06, 2.89e-06, 0.00e+00, 1.78e-06, 1.40e-06, 5.20e-07,
        6.60e-07, 2.03e-06, 4.70e-07, 1.16e-06, 0.00e+00, 1.26e-06,
        0.00e+00, 0.00e+00, 0.00e+00, 1.80e-07, 1.65e-06, 2.40e-06,
        7.30e-07, 0.00e+00, 2.87e-06, 0.00e+00, 6.20e-07, 5.20e-07,
        1.70e-07, 0.00e+00, 9.80e-07, 5.10e-07],
       [0.00e+00, 2.50e-07, 1.19e-06, 1.17e-06, 1.15e-06, 0.00e+00,
        1.24e-06, 4.00e-07, 0.00e+00, 0.00e+00, 0.00e+00, 7.00e-08,
        1.53e-06, 0.00e+00, 1.33e-06, 0.00e+00, 1.30e-07, 4.60e-07,
        5.00e-08, 0.00e+00, 0.00e+00, 4.20e-06, 1.29e-06, 0.00e+00,
        7.70e-07, 2.90e-06, 1.76e-06, 2.82e-06, 2.20e-07, 5.30e-07,
        3.00e-07, 0.00e+00, 0.00e+00, 2.56e-06, 1.60e-07, 7.30e-07,
        5.90e-07, 1.50e-07, 1.44e-06, 5.80e-07, 2.20e-06, 0.00e+00,
        0.00e+00, 7.30e-07, 0.00e+00, 0.00e+00, 2.39e-06, 0.00e+00,
        1.22e-06, 3.68e-06, 1.57e-06, 0.00e+00, 9.00e-07, 9.00e-08,
        6.00e-08, 1.16e-06, 0.00e+00, 2.90e-07, 4.00e-08, 3.50e-07,
        9.50e-07, 0.00e+00, 0.00e+00, 1.55e-06, 1.84e-06, 0.00e+00,
        2.10e-07, 1.70e-06, 0.00e+00, 0.00e+00, 0.00e+00, 0.00e+00,
        1.65e-06, 1.60e-06, 2.77e-06, 0.00e+00, 6.90e-07, 3.30e-07,
        3.30e-07, 5.00e-07, 5.00e-07, 4.60e-07, 2.08e-06, 2.50e-07,
        3.10e-07, 1.97e-06, 1.20e-06, 6.90e-07, 1.27e-06, 0.00e+00,
        1.26e-06, 2.80e-07, 4.50e-07, 4.00e-08, 0.00e+00, 1.14e-06,
        1.95e-06, 5.70e-07, 0.00e+00, 0.00e+00],
       [5.70e-07, 6.90e-07, 0.00e+00, 3.70e-07, 6.00e-08, 4.70e-07,
        5.80e-07, 1.08e-06, 1.96e-06, 1.66e-06, 1.20e-06, 1.78e-06,
        0.00e+00, 1.87e-06, 1.90e-07, 8.40e-07, 0.00e+00, 0.00e+00,
        0.00e+00, 1.20e-07, 1.10e-07, 2.61e-06, 6.00e-07, 1.26e-06,
        5.20e-07, 0.00e+00, 0.00e+00, 4.07e-06, 3.50e-07, 6.60e-07,
        1.70e-07, 7.70e-07, 6.50e-07, 0.00e+00, 3.50e-07, 0.00e+00,
        0.00e+00, 2.60e-07, 0.00e+00, 2.72e-06, 3.82e-06, 1.39e-06,
        1.67e-06, 1.00e-07, 3.31e-06, 3.20e-07, 0.00e+00, 2.58e-06,
        1.93e-06, 2.71e-06, 0.00e+00, 1.03e-06, 1.04e-06, 0.00e+00,
        0.00e+00, 0.00e+00, 1.74e-06, 7.10e-07, 1.85e-06, 3.12e-06,
        6.00e-07, 1.60e-07, 1.05e-06, 1.18e-06, 8.80e-07, 1.30e-06,
        0.00e+00, 9.00e-08, 1.01e-06, 1.69e-06, 1.00e-08, 7.20e-07,
        0.00e+00, 0.00e+00, 3.33e-06, 2.16e-06, 1.61e-06, 0.00e+00,
        2.90e-07, 0.00e+00, 0.00e+00, 0.00e+00, 5.90e-07, 0.00e+00,
        8.00e-08, 7.30e-07, 2.43e-06, 0.00e+00, 1.37e-06, 2.07e-06,
        1.45e-06, 1.02e-06, 0.00e+00, 1.80e-07, 1.40e-06, 0.00e+00,
        5.80e-07, 1.21e-06, 3.30e-07, 1.90e-07],
       [1.36e-06, 0.00e+00, 6.80e-07, 1.00e-08, 2.70e-07, 1.30e-06,
        1.76e-06, 4.50e-07, 7.10e-07, 9.00e-08, 6.00e-07, 2.83e-06,
        6.90e-07, 1.49e-06, 1.36e-06, 5.10e-07, 2.00e-07, 2.15e-06,
        3.20e-07, 1.52e-06, 6.60e-07, 1.24e-06, 5.81e-06, 1.51e-06,
        3.60e-07, 1.83e-06, 9.30e-07, 0.00e+00, 2.30e-06, 2.88e-06,
        0.00e+00, 3.80e-07, 0.00e+00, 7.50e-07, 2.70e-07, 2.35e-06,
        1.34e-06, 8.20e-07, 2.57e-06, 0.00e+00, 0.00e+00, 4.68e-06,
        1.69e-06, 1.21e-06, 1.97e-06, 1.00e-06, 1.74e-06, 1.81e-06,
        0.00e+00, 0.00e+00, 1.29e-06, 8.80e-07, 0.00e+00, 1.05e-06,
        1.05e-06, 2.88e-06, 6.20e-07, 3.21e-06, 0.00e+00, 0.00e+00,
        0.00e+00, 2.90e-07, 1.06e-06, 0.00e+00, 2.49e-06, 5.10e-07,
        3.16e-06, 1.69e-06, 1.33e-06, 1.79e-06, 2.03e-06, 3.13e-06,
        1.34e-06, 6.00e-07, 2.05e-06, 3.03e-06, 0.00e+00, 7.00e-07,
        0.00e+00, 9.70e-07, 3.30e-07, 9.80e-07, 1.87e-06, 4.40e-07,
        7.90e-07, 1.04e-06, 1.15e-06, 4.40e-07, 0.00e+00, 7.60e-07,
        0.00e+00, 1.73e-06, 7.50e-07, 1.09e-06, 7.50e-07, 5.40e-07,
        0.00e+00, 1.10e-07, 9.80e-07, 4.60e-07]], 

      [[1.80e-07, 2.90e-07, 1.46e-06, 2.06e-06, 2.90e-07, 1.36e-06,
        3.29e-06, 0.00e+00, 4.20e-07, 2.15e-06, 6.70e-07, 1.83e-06,
        2.23e-06, 1.58e-06, 0.00e+00, 0.00e+00, 4.90e-07, 6.30e-07,
        0.00e+00, 2.70e-07, 0.00e+00, 0.00e+00, 2.10e-07, 0.00e+00,
        1.04e-06, 0.00e+00, 0.00e+00, 9.10e-07, 5.00e-08, 1.46e-06,
        0.00e+00, 1.70e-06, 1.38e-06, 0.00e+00, 2.18e-06, 3.18e-06,
        0.00e+00, 2.18e-06, 1.55e-06, 1.30e-07, 3.04e-06, 5.74e-06,
        5.00e-07, 1.91e-06, 0.00e+00, 4.77e-06, 6.20e-07, 1.59e-06,
        2.73e-06, 5.20e-07, 1.98e-06, 0.00e+00, 2.47e-06, 3.27e-06,
        0.00e+00, 0.00e+00, 4.81e-06, 1.63e-06, 0.00e+00, 0.00e+00,
        1.10e-06, 7.00e-07, 1.96e-06, 0.00e+00, 1.76e-06, 0.00e+00,
        2.00e-08, 5.10e-07, 6.80e-07, 6.00e-07, 1.05e-06, 1.07e-06,
        9.30e-07, 8.00e-07, 0.00e+00, 0.00e+00, 0.00e+00, 8.00e-08,
        1.66e-06, 3.64e-06, 1.74e-06, 1.04e-06, 9.80e-07, 4.40e-07,
        0.00e+00, 4.00e-07, 2.46e-06, 0.00e+00, 3.40e-07, 1.59e-06,
        1.02e-06, 1.50e-06, 0.00e+00, 1.52e-06, 0.00e+00, 5.30e-07,
        5.20e-07, 6.50e-07, 9.10e-07, 8.60e-07],
       [0.00e+00, 8.20e-07, 0.00e+00, 1.73e-06, 7.20e-07, 2.23e-06,
        4.20e-07, 2.46e-06, 9.90e-07, 0.00e+00, 0.00e+00, 0.00e+00,
        2.10e-07, 7.00e-07, 2.92e-06, 1.38e-06, 0.00e+00, 0.00e+00,
        7.80e-07, 0.00e+00, 3.00e-06, 3.90e-07, 2.00e-07, 1.11e-06,
        0.00e+00, 9.00e-08, 2.85e-06, 3.86e-06, 3.30e-07, 0.00e+00,
        1.26e-06, 0.00e+00, 0.00e+00, 5.70e-07, 3.30e-06, 1.67e-06,
        1.62e-06, 1.83e-06, 1.00e-08, 1.84e-06, 0.00e+00, 4.01e-06,
        8.60e-07, 0.00e+00, 1.09e-06, 3.29e-06, 0.00e+00, 1.20e-07,
        0.00e+00, 1.22e-06, 2.80e-06, 3.44e-06, 0.00e+00, 2.48e-06,
        2.18e-06, 1.59e-06, 4.88e-06, 0.00e+00, 3.96e-06, 2.90e-07,
        0.00e+00, 1.34e-06, 0.00e+00, 3.33e-06, 1.32e-06, 1.23e-06,
        0.00e+00, 2.70e-06, 4.30e-07, 0.00e+00, 0.00e+00, 9.30e-07,
        0.00e+00, 0.00e+00, 9.80e-07, 1.07e-06, 2.58e-06, 6.60e-07,
        9.00e-08, 0.00e+00, 6.50e-07, 6.00e-07, 2.26e-06, 8.70e-07,
        7.00e-08, 1.16e-06, 9.40e-07, 8.20e-07, 1.30e-07, 1.00e-07,
        0.00e+00, 8.50e-07, 4.40e-07, 1.84e-06, 6.30e-07, 2.70e-07,
        2.10e-07, 0.00e+00, 1.87e-06, 6.30e-07],
       [2.90e-07, 0.00e+00, 5.00e-07, 1.98e-06, 1.70e-07, 1.90e-07,
        8.90e-07, 4.00e-07, 7.70e-07, 2.35e-06, 2.65e-06, 3.15e-06,
        0.00e+00, 0.00e+00, 5.60e-07, 1.24e-06, 8.30e-07, 1.52e-06,
        2.60e-07, 7.10e-07, 1.48e-06, 1.39e-06, 1.50e-06, 1.10e-07,
        9.80e-07, 1.00e-07, 2.10e-07, 0.00e+00, 4.60e-07, 7.00e-07,
        1.04e-06, 7.90e-07, 1.40e-07, 5.70e-07, 2.48e-06, 0.00e+00,
        4.89e-06, 0.00e+00, 0.00e+00, 0.00e+00, 1.35e-06, 0.00e+00,
        9.30e-07, 2.35e-06, 2.20e-07, 1.21e-06, 1.70e-07, 3.29e-06,
        1.10e-06, 0.00e+00, 5.70e-07, 1.23e-06, 6.20e-07, 3.76e-06,
        3.84e-06, 2.35e-06, 3.22e-06, 2.83e-06, 5.37e-06, 2.87e-06,
        7.20e-07, 3.54e-06, 3.00e-08, 6.40e-07, 3.00e-08, 4.00e-07,
        2.86e-06, 0.00e+00, 7.90e-07, 1.81e-06, 2.50e-07, 8.30e-07,
        6.00e-08, 1.07e-06, 1.10e-06, 1.90e-07, 7.00e-08, 0.00e+00,
        0.00e+00, 1.10e-06, 1.90e-06, 0.00e+00, 0.00e+00, 0.00e+00,
        1.94e-06, 1.94e-06, 0.00e+00, 7.00e-08, 0.00e+00, 0.00e+00,
        2.30e-07, 0.00e+00, 1.79e-06, 2.36e-06, 2.40e-07, 0.00e+00,
        7.70e-07, 0.00e+00, 0.00e+00, 0.00e+00],
       [7.00e-08, 9.70e-07, 9.20e-07, 0.00e+00, 0.00e+00, 0.00e+00,
        0.00e+00, 1.63e-06, 0.00e+00, 6.40e-07, 1.40e-07, 6.00e-08,
        9.30e-07, 2.40e-07, 2.03e-06, 1.95e-06, 1.59e-06, 5.00e-08,
        1.80e-07, 3.50e-07, 2.46e-06, 1.00e-08, 0.00e+00, 4.50e-07,
        1.38e-06, 6.60e-07, 1.37e-06, 2.70e-07, 0.00e+00, 1.91e-06,
        9.00e-08, 1.10e-06, 1.76e-06, 3.20e-07, 0.00e+00, 3.09e-06,
        3.88e-06, 1.09e-06, 1.48e-06, 3.56e-06, 2.23e-06, 3.63e-06,
        0.00e+00, 1.26e-06, 6.90e-07, 0.00e+00, 1.15e-06, 0.00e+00,
        3.86e-06, 1.31e-06, 0.00e+00, 3.22e-06, 1.62e-06, 0.00e+00,
        2.84e-06, 2.34e-06, 0.00e+00, 3.60e-07, 3.12e-06, 1.83e-06,
        6.60e-07, 0.00e+00, 0.00e+00, 1.59e-06, 0.00e+00, 2.00e-08,
        2.70e-07, 1.88e-06, 0.00e+00, 3.00e-08, 2.00e-06, 0.00e+00,
        2.52e-06, 2.32e-06, 1.80e-07, 8.90e-07, 3.70e-07, 8.20e-07,
        1.14e-06, 1.35e-06, 0.00e+00, 8.50e-07, 1.89e-06, 1.42e-06,
        5.30e-07, 0.00e+00, 1.09e-06, 7.40e-07, 2.60e-07, 4.00e-08,
        1.89e-06, 1.14e-06, 7.10e-07, 0.00e+00, 3.20e-07, 2.24e-06,
        0.00e+00, 8.20e-07, 1.85e-06, 7.10e-07]]])


	model = FactorizedBasset(4, seq_len)
	precomputation = precompute(model, seq_len=seq_len, n_choices=4, alpha=1.5)
	isms = yuzu_ism(model, X, precomputation)
	assert_array_almost_equal(isms, factorized_basset_ism_scores, 8)

def test_small_probes_bpnet():
	bpnet_ism_scores = numpy.array([
	  [[0.0055, 0.0054, 0.0067, 0.    , 0.    , 0.0066, 0.    , 0.    ,
        0.0066, 0.0102, 0.0084, 0.    , 0.0131, 0.0097, 0.    , 0.0108,
        0.    , 0.0104, 0.0121, 0.0111, 0.009 , 0.    , 0.    , 0.0088,
        0.    , 0.012 , 0.0117, 0.0092, 0.    , 0.    , 0.0096, 0.0096,
        0.0098, 0.0121, 0.    , 0.0105, 0.0089, 0.    , 0.0109, 0.0103,
        0.0109, 0.0115, 0.0131, 0.    , 0.0111, 0.0121, 0.0125, 0.0106,
        0.0102, 0.0106, 0.0119, 0.0101, 0.0102, 0.0118, 0.0106, 0.0119,
        0.0097, 0.    , 0.0099, 0.0106, 0.0092, 0.0095, 0.0114, 0.0096,
        0.    , 0.0095, 0.0098, 0.    , 0.0111, 0.0101, 0.0128, 0.0107,
        0.0117, 0.0098, 0.    , 0.0102, 0.0116, 0.0099, 0.0079, 0.0099,
        0.011 , 0.0101, 0.    , 0.0081, 0.    , 0.    , 0.    , 0.0098,
        0.01  , 0.007 , 0.0074, 0.    , 0.0096, 0.    , 0.0065, 0.0079,
        0.0057, 0.    , 0.0091, 0.011 ],
       [0.    , 0.0065, 0.0064, 0.0098, 0.0084, 0.    , 0.0088, 0.007 ,
        0.    , 0.    , 0.    , 0.0092, 0.0099, 0.    , 0.0105, 0.    ,
        0.0126, 0.0092, 0.008 , 0.    , 0.    , 0.0098, 0.0093, 0.    ,
        0.01  , 0.0102, 0.0109, 0.0098, 0.0112, 0.0099, 0.0125, 0.    ,
        0.0094, 0.0143, 0.0112, 0.0097, 0.0093, 0.0107, 0.0112, 0.0091,
        0.0108, 0.    , 0.    , 0.0128, 0.    , 0.    , 0.0107, 0.    ,
        0.0141, 0.0113, 0.013 , 0.    , 0.0111, 0.0124, 0.0113, 0.0125,
        0.    , 0.0109, 0.0092, 0.0123, 0.0119, 0.    , 0.    , 0.01  ,
        0.0096, 0.    , 0.0083, 0.0092, 0.    , 0.    , 0.    , 0.    ,
        0.0092, 0.0105, 0.0121, 0.    , 0.0097, 0.01  , 0.0092, 0.009 ,
        0.0111, 0.0075, 0.0118, 0.0094, 0.0095, 0.0076, 0.009 , 0.0091,
        0.0103, 0.    , 0.0061, 0.0076, 0.0072, 0.0064, 0.    , 0.0063,
        0.0059, 0.0062, 0.    , 0.    ],
       [0.006 , 0.0063, 0.    , 0.0078, 0.0055, 0.0064, 0.0073, 0.0072,
        0.0093, 0.01  , 0.0089, 0.0082, 0.    , 0.0102, 0.0111, 0.0091,
        0.0093, 0.    , 0.    , 0.0097, 0.0083, 0.009 , 0.0111, 0.0102,
        0.0115, 0.    , 0.    , 0.0103, 0.0117, 0.0105, 0.0134, 0.0101,
        0.0106, 0.    , 0.0125, 0.    , 0.    , 0.0123, 0.    , 0.0105,
        0.0122, 0.0134, 0.0126, 0.0116, 0.0112, 0.0129, 0.    , 0.0104,
        0.0139, 0.0112, 0.    , 0.0113, 0.0103, 0.    , 0.    , 0.    ,
        0.011 , 0.0112, 0.0118, 0.0118, 0.0117, 0.0121, 0.0112, 0.0095,
        0.0088, 0.0096, 0.    , 0.0095, 0.0101, 0.0108, 0.0119, 0.0108,
        0.    , 0.    , 0.0129, 0.0119, 0.0114, 0.    , 0.0091, 0.    ,
        0.    , 0.    , 0.0088, 0.    , 0.0107, 0.0082, 0.0115, 0.    ,
        0.0082, 0.0076, 0.0075, 0.0072, 0.    , 0.0059, 0.0081, 0.    ,
        0.0081, 0.0063, 0.0059, 0.0053],
       [0.0052, 0.    , 0.0068, 0.0064, 0.0066, 0.0079, 0.0083, 0.0062,
        0.0101, 0.0089, 0.0088, 0.0079, 0.011 , 0.0102, 0.0085, 0.0115,
        0.0111, 0.011 , 0.008 , 0.0099, 0.009 , 0.0087, 0.0096, 0.009 ,
        0.0113, 0.009 , 0.0113, 0.    , 0.0099, 0.0107, 0.    , 0.0103,
        0.    , 0.0108, 0.0108, 0.0114, 0.0099, 0.011 , 0.0144, 0.    ,
        0.    , 0.0122, 0.0101, 0.0099, 0.0127, 0.0113, 0.0113, 0.0102,
        0.    , 0.    , 0.0118, 0.009 , 0.    , 0.0107, 0.0115, 0.0114,
        0.0108, 0.01  , 0.    , 0.    , 0.    , 0.0085, 0.0131, 0.    ,
        0.0095, 0.0114, 0.0107, 0.0096, 0.0095, 0.0102, 0.0096, 0.0086,
        0.01  , 0.0092, 0.0077, 0.0094, 0.    , 0.01  , 0.    , 0.0097,
        0.0101, 0.0073, 0.0092, 0.0085, 0.0091, 0.0098, 0.0076, 0.009 ,
        0.    , 0.0116, 0.    , 0.0082, 0.0074, 0.0074, 0.0071, 0.0077,
        0.    , 0.0048, 0.0055, 0.0075]],

      [[0.0065, 0.0071, 0.0053, 0.0075, 0.0077, 0.0052, 0.0093, 0.    ,
        0.0098, 0.0109, 0.0091, 0.0069, 0.0121, 0.0076, 0.    , 0.    ,
        0.0107, 0.0091, 0.    , 0.0095, 0.    , 0.    , 0.0097, 0.    ,
        0.011 , 0.    , 0.    , 0.0085, 0.0103, 0.0117, 0.    , 0.01  ,
        0.0103, 0.    , 0.0094, 0.0117, 0.    , 0.0115, 0.0117, 0.0113,
        0.0121, 0.0101, 0.011 , 0.0101, 0.    , 0.0115, 0.0111, 0.0107,
        0.0113, 0.0112, 0.0114, 0.    , 0.0132, 0.0119, 0.    , 0.    ,
        0.0123, 0.0108, 0.    , 0.    , 0.0111, 0.0127, 0.0093, 0.    ,
        0.0112, 0.    , 0.01  , 0.0107, 0.0087, 0.0099, 0.0105, 0.0095,
        0.0095, 0.0089, 0.    , 0.    , 0.    , 0.0092, 0.0107, 0.0084,
        0.0093, 0.0107, 0.0097, 0.0095, 0.    , 0.0074, 0.0098, 0.    ,
        0.0114, 0.0109, 0.0068, 0.0084, 0.    , 0.0063, 0.    , 0.0069,
        0.0063, 0.005 , 0.0062, 0.0086],
       [0.    , 0.0055, 0.    , 0.0086, 0.0085, 0.0081, 0.0071, 0.007 ,
        0.008 , 0.    , 0.    , 0.    , 0.0079, 0.0097, 0.0099, 0.0094,
        0.    , 0.    , 0.01  , 0.    , 0.0086, 0.0088, 0.0091, 0.0087,
        0.    , 0.0091, 0.0094, 0.0109, 0.0121, 0.    , 0.0107, 0.    ,
        0.    , 0.0104, 0.0098, 0.0108, 0.0112, 0.0117, 0.0119, 0.0106,
        0.    , 0.0101, 0.0101, 0.    , 0.011 , 0.0115, 0.    , 0.0112,
        0.    , 0.0105, 0.0111, 0.0106, 0.    , 0.0104, 0.0129, 0.0109,
        0.0097, 0.    , 0.0117, 0.0117, 0.    , 0.0104, 0.0116, 0.0104,
        0.0099, 0.0109, 0.    , 0.0107, 0.0088, 0.    , 0.    , 0.0098,
        0.    , 0.    , 0.0109, 0.0091, 0.0113, 0.0091, 0.01  , 0.    ,
        0.0101, 0.0087, 0.0097, 0.0106, 0.0088, 0.0077, 0.009 , 0.0087,
        0.0108, 0.0073, 0.    , 0.0075, 0.0085, 0.0061, 0.0076, 0.006 ,
        0.0056, 0.    , 0.0086, 0.01  ],
       [0.0058, 0.    , 0.006 , 0.0073, 0.006 , 0.0065, 0.0077, 0.007 ,
        0.0082, 0.0094, 0.0083, 0.0079, 0.    , 0.    , 0.0109, 0.0105,
        0.0107, 0.01  , 0.0125, 0.0099, 0.0091, 0.0082, 0.0102, 0.0094,
        0.0093, 0.0123, 0.011 , 0.    , 0.01  , 0.0101, 0.0129, 0.0102,
        0.0114, 0.0114, 0.0116, 0.    , 0.0111, 0.    , 0.    , 0.    ,
        0.0122, 0.    , 0.0127, 0.0102, 0.0122, 0.0108, 0.0109, 0.01  ,
        0.0091, 0.    , 0.011 , 0.0102, 0.0122, 0.0125, 0.0098, 0.0128,
        0.0101, 0.0113, 0.0104, 0.0112, 0.0111, 0.0108, 0.0098, 0.0099,
        0.011 , 0.012 , 0.0096, 0.    , 0.0096, 0.0077, 0.0101, 0.0112,
        0.009 , 0.0092, 0.0096, 0.0102, 0.0092, 0.    , 0.    , 0.0105,
        0.0099, 0.    , 0.    , 0.    , 0.0094, 0.0082, 0.    , 0.0097,
        0.    , 0.    , 0.0068, 0.    , 0.0106, 0.0056, 0.0082, 0.    ,
        0.0079, 0.0059, 0.    , 0.    ],
       [0.006 , 0.0074, 0.0057, 0.    , 0.    , 0.    , 0.    , 0.0077,
        0.    , 0.0088, 0.0092, 0.0089, 0.0101, 0.0102, 0.0084, 0.0085,
        0.0091, 0.0097, 0.0096, 0.0114, 0.0091, 0.0097, 0.    , 0.0097,
        0.0107, 0.0086, 0.0099, 0.0101, 0.    , 0.0113, 0.0104, 0.0086,
        0.0095, 0.0125, 0.    , 0.0121, 0.0107, 0.0118, 0.0131, 0.0127,
        0.0106, 0.0115, 0.    , 0.0111, 0.0107, 0.    , 0.012 , 0.    ,
        0.0111, 0.0111, 0.    , 0.0098, 0.01  , 0.    , 0.0101, 0.0121,
        0.    , 0.0108, 0.0117, 0.0101, 0.0128, 0.    , 0.    , 0.0111,
        0.    , 0.0092, 0.0099, 0.0097, 0.    , 0.0079, 0.0107, 0.    ,
        0.0114, 0.0099, 0.0086, 0.0095, 0.009 , 0.0085, 0.0099, 0.0083,
        0.    , 0.0091, 0.0091, 0.0105, 0.0079, 0.    , 0.0092, 0.0098,
        0.0085, 0.0066, 0.006 , 0.0075, 0.0083, 0.    , 0.0073, 0.0088,
        0.    , 0.006 , 0.0063, 0.006 ]]])


	model = BPNet(4, seq_len)
	precomputation = precompute(model, seq_len=seq_len, n_choices=4, alpha=1)
	isms = yuzu_ism(model, X, precomputation)
	assert_array_almost_equal(isms, bpnet_ism_scores, 3)
